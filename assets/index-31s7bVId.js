var Eo=(b,w)=>()=>(w||b((w={exports:{}}).exports,w),w.exports);var Fo=Eo((Xr,Fn)=>{(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))p(S);new MutationObserver(S=>{for(const A of S)if(A.type==="childList")for(const N of A.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&p(N)}).observe(document,{childList:!0,subtree:!0});function h(S){const A={};return S.integrity&&(A.integrity=S.integrity),S.referrerPolicy&&(A.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?A.credentials="include":S.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function p(S){if(S.ep)return;S.ep=!0;const A=h(S);fetch(S.href,A)}})();const Be={};Be.parseBase64Data=function(b){var w,h;return h=b.substring(b.indexOf(":")+1,b.indexOf(";")),w=b.substring(b.indexOf(",")+1),{type:h,data:w}};Be.parseQueryString=function(b){var w,h,p;return w=b.indexOf(":"),p="",h=b,w>0&&(p=b.substring(0,w),h=b.substring(w+1)),{tag:p,q:h}};Be.dataURL2ObjectURL=function(b){if(!window.URL||!window.URL.createObjectURL)return"";const w=Be.dataURL2Blob(b);return w?window.URL.createObjectURL(w):""};Be.blobToString=function(b,w){const h=new FileReader;return h.onload=function(){return w(null,h.result)},h.readAsText(b)};Be.base642Blob=function(b,w){var h,p,S,A,N,D,L,B,Q,K,H,ee;for(w=w||"",H=1024,A=atob(b),D=A.length,ee=Math.ceil(D/H),S=new Array(ee),K=0;K<ee;){for(h=K*H,L=Math.min(h+H,D),N=new Array(L-h),Q=h,B=0;Q<L;)N[B]=A[Q].charCodeAt(0),++B,++Q;S[K]=new Uint8Array(N),K++}return p=new Blob(S,{type:w}),p};Be.blob2Base64=function(b,w){var h;return h=new window.FileReader,h.onloadend=function(){var p,S;return S=h.result,p=S.substr(S.indexOf(",")+1),w(null,p)},h.readAsDataURL(b)};Be.blob2Text=function(b,w){var h;return h=new window.FileReader,h.onloadend=function(){return w(null,h.result)},h.readAsText(b)};Be.blob2DataURL=function(b,w){var h;return h=new window.FileReader,h.onloadend=function(){var p;return p=h.result,w(null,p)},h.readAsDataURL(b)};Be.dataURL2String=function(b){var w,h,p,S,A,N,D;if(!(!window.URL||!window.URL.createObjectURL)){if(N=b.split(",")[0],p=b.split(",")[1],w="",N.indexOf("base64")>=0){D=function(L){var B,Q,K,H;for(B=new ArrayBuffer(L.length),Q=new Uint8Array(B),K=0,H=L.length;K<H;)Q[K]=L.charCodeAt(K),K++;return B};try{w=atob(p),h=D(w),S=new TextDecoder("UTF-8"),w=S.decode(h)}catch(L){A=L,w=""}}else w=unescape(p);return w}};Be.dataURL2Blob=function(b){var w,h,p,S,A,N,D,L,B;if(!(!window.URL||!window.URL.createObjectURL)){if(N=b.split(",")[0],p=b.split(",")[1],w="",N.indexOf("base64")>=0)try{w=atob(p)}catch(Q){S=Q,w=""}else w=unescape(p);for(A=N.split(":")[1].split(";")[0],h=new Uint8Array(w.length),D=L=0,B=w.length;0<=B?L<=B:L>=B;D=0<=B?++L:--L)h[D]=w.charCodeAt(D);return new Blob([h],{type:A})}};Be.objectURLToArrayBuffer=function(b,w){var h;if(!b){w("objectURL required");return}return h=new XMLHttpRequest,h.open("GET",b,!0),h.responseType="arraybuffer",h.onload=function(p){return this.status===200||this.status===0?w(null,this.response,this.getResponseHeader("Content-Type")||"image/png"):w("convert error")},h.onerror=function(p){return w(p)},h.send()};Be.objectURLToString=function(b,w){var h;return h=new XMLHttpRequest,h.open("GET",b,!0),h.responseType="text",h.onload=function(p){return this.status===200||this.status===0?w(null,this.response):w("convert error")},h.onerror=function(p){return w(p)},h.send()};Be.urlToBlob=function(b,w){b||w(""),fetch(b,{referrer:""}).then(h=>h.blob()).then(h=>w(h)).catch(h=>{w("")})};Be.urlToDataURL=function(b,w){var h;return h=new XMLHttpRequest,h.open("GET",b,!0),h.responseType="blob",h.onload=function(p){var S,A;return this.status===200||this.status===0?(S=this.response,A=new FileReader,A.onerror=function(N){return w(N)},A.onload=function(N){var D;return D=N.target.result,w(null,D)},A.readAsDataURL(S)):w("convert error")},h.onerror=function(p){w("error")},h.ontimeout=function(p){w("tiemout")},h.onabort=function(p){w("abort")},h.send()};Be.stringToArrayBuffer=function(b){var w,h;return w=new TextEncoder,h=w.encode(b),h};Be.arrayBufferToBase64=function(b){var w,h,p,S;for(w="",h=new Uint8Array(b),S=h.byteLength,p=0;p<S;)w+=String.fromCharCode(h[p]),p++;return window.btoa(w)};Be.base64ToArrayBuffer=function(b){var w,h,p,S;for(w=window.atob(b),S=w.length,h=new Uint8Array(S),p=0;p<S;)h[p]=w.charCodeAt(p),p++;return h.buffer};Be.blobToArrayBuffer=function(b,w){var h;return h=new FileReader,h.onerror=function(p){return w(p)},h.onload=function(){var p;return p=this.result,w(null,p)},h.readAsArrayBuffer(b)};Be.arrayBufferToNodeBuffer=function(b){var w,h,p,S,A;for(w=new Buffer(b.byteLength),A=new Uint8Array(b),h=p=0,S=w.length;p<S;h=++p)w[h],w[h]=A[h];return w};Be.nodeBufferToArrayBuffer=function(b){return new Uint8Array(b).buffer};Be.blobToMd5=function(b,w){return new Promise((h,p)=>{w||(w=(S,A)=>{S?p(S):h(A)}),Be.blobToArrayBuffer(b,function(S){return function(A,N){var D,L;return N?(L=new SparkMD5.ArrayBuffer,L.append(N),D=L.end(),w(null,D)):w(A)}}())})};const Zt={};Zt.timeoutFn=function(b="",w=3e3){return async function(){return new Promise(h=>{setTimeout(()=>{h(b)},w)})}};Zt.timeoutProxyFn=async function(b,w={}){const h=Zt.timeoutFn(w.result,w.maxTimeout);return Promise.race([b(),h()])};const qt=()=>{let b=Date.now();return b<=qt.previous?b=++qt.previous:qt.previous=b,b};qt.previous=0;const Ke={},Do=function(b){var w,h,p,S,A,N,D,L;for(D=[],p=[].slice.call(b.attributes),L=[],A=0,N=p.length;A<N;A++)h=p[A],w=h.name,w.indexOf("on")===0?(S={},S.attribute=h.name,S.value=h.value,D.push(S),L.push(b.attributes.removeNamedItem(w))):L.push(void 0);return L};Ke.stripScripts=function(b){var w,h,p,S,A,N,D,L,B,Q,K;for(L=new DOMParser,K=L.parseFromString("","text/html"),p=K.body,p.innerHTML=b,D=p.getElementsByTagName("meta"),S=D.length;S--;)D[S].remove();for(B=p.getElementsByTagName("script"),S=B.length;S--;)w=B[S],w.remove();for(h=p.getElementsByTagName("*"),A=0,N=h.length;A<N;A++)Q=h[A],Do(Q);return p.innerHTML};Ke.stripStyles=function(b){var w,h,p,S,A,N,D,L;for(N=new DOMParser,L=N.parseFromString("","text/html"),p=L.body,p.innerHTML=b,A=p.getElementsByTagName("link"),S=A.length;S--;)A[S].remove();for(D=p.getElementsByTagName("style"),S=D.length;S--;)w=D[S],h=w.outerHTML,w.outerHTML="<pre><code>"+_.escape(h)+"</code></pre>";return p.innerHTML};Ke.escapeHtml=function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};Ke.isElementInViewport=function(b){const w=b.ownerDocument;if(!w)return!1;const h=w.defaultView;if(!h)return!1;var p=b.getBoundingClientRect();return p.top>=0&&p.left>=0&&p.bottom<=(h.innerHeight||w.documentElement.clientHeight)&&p.right<=(h.innerWidth||w.documentElement.clientWidth)};Ke.captureVideo=function(b){if(b.tagName!=="VIDEO")return"";const w=document.createElement("canvas");return w.width=b.videoWidth,w.height=b.videoHeight,w.getContext("2d").drawImage(b,0,0,b.videoWidth,b.videoHeight),w.toDataURL("image/jpeg")};Ke.appHighlightPos=function(b,w){if(w=w||{},w.skipIfHighlighting&&Ke.appHighlightPos.highlightPosTimeout)return;var h=document.querySelector(".app_highlight_pos_element"),p=function(){Ke.appHighlightPos.highlightPosTimeout&&clearTimeout(Ke.appHighlightPos.highlightPosTimeout),Ke.appHighlightPos.highlightPosTimeout=null,h&&h.parentNode&&h.parentNode.removeChild(h)};Ke.appHighlightPos.highlightPosTimeout&&(clearTimeout(Ke.appHighlightPos.highlightPosTimeout),Ke.appHighlightPos.highlightPosTimeout=null),h||(h=document.createElement("div"),h.classList.add("app_highlight_pos_element"),h.classList.add("highlight-pos"),document.body.append(h));let S=b.left,A=b.top;w.offsetLeft&&(S+=w.offsetLeft),w.offsetTop&&(A+=w.offsetTop),h.style.left=S+"px",h.style.top=A+"px",Ke.appHighlightPos.highlightPosTimeout=setTimeout(p,w.autoHideTimeout||1e3)};Ke.appHighlightPosByEl=function(b,w={}){const h=b.getBoundingClientRect(),p={left:h.left,top:h.top};w.rb&&(p.left+=h.width,p.top+=h.height),Ke.appHighlightPos(p,w)};Ke.convertElementToNewTagName=function(b,w){let h=b.tagName;const p=b.ownerDocument||document;if(h===w)return b;const S=p.createDocumentFragment();for(;b.firstChild;)S.appendChild(b.firstChild);const A=p.createElement(w);return A.appendChild(S),function(D,L){[...L.attributes].forEach(B=>{D.setAttribute(B.nodeName,B.nodeValue)})}(A,b),b.parentNode.replaceChild(A,b),A};window.CONSTANT||(window.CONSTANT={exportHosts:"http://localhost:3011",exportHost:"https://colorink.top"});var Qr;const Pt={host:(Qr=window.CONSTANT)==null?void 0:Qr.exportHost,maxFilesize:1024*1024*30},Po=async function(b){const w=async function(){return(await(await fetch(Pt.host+"/getcrossorigindomainresource?"+new URLSearchParams({url:b}))).json()).data};return Zt.timeoutProxyFn(w,{maxTimeout:1e4})},qo=function(b){const w=async function(p){return new Promise(function(S,A){b(p,function(N){S(N)})})},h=async function(p){const S=await w(p);return S||await Po(p)};return function(p,S){h(p).then(S).catch(()=>S(""))}},Lo=function(b,w){const h=new Image;h.onload=function(){const p=document.createElement("canvas");p.width=this.naturalWidth,p.height=this.naturalHeight,p.getContext("2d").drawImage(this,0,0),p.toBlob(w,"image/jpeg",.95)},h.onerror=function(){w()},h.src=b.src},Wr=function(b,w){var h,p,S,A,N,D,L,B,Q,K;const H=$(b);if(H.attr("width"),H.attr("height"),L=b.naturalWidth||H.width(),D=b.naturalHeight||H.height(),H.width(),H.height(),w.indexOf("data:image/svg")===0)return Q=Be.dataURL2String(w),A=`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <style>
          html, body{
            margin: 0;
            padding: 0;
            overflow: hidden;
          }
          body>svg{
            width: ${L}px!important;
            height: ${D}px!important;
            max-width: 100%!important;
          }
          </style>
        </head>
        <body>
        ${Q}
        </body>
      </html>
    `,K=Be.stringToArrayBuffer(A),N="data:text/html;base64,"+Be.arrayBufferToBase64(K),B=H.attr("style"),p=H.attr("class"),S=H.attr("id"),h=$("<iframe src='"+N+"' style='max-width: 100%;'></iframe"),h.attr("width",L),h.attr("height",D),B&&h.attr("style",B),p&&h.attr("class",p),S&&h.attr("id",S),h.css({border:"0",overflow:"hidden",width:L,height:D,display:"inline-block"}),H.replaceWith(h)},Ro=function(b){b.find(".attachment, video, audio, iframe").remove(),b.find("picture").each(function(w,h){Ke.convertElementToNewTagName(h,"div")}),b.find("figure").each(function(w,h){Ke.convertElementToNewTagName(h,"div")}),b.find("figcaption").each(function(w,h){Ke.convertElementToNewTagName(h,"span")})},ko={marginTop:10,marginRight:10,marginBottom:10,marginLeft:10,zoom:1,orientation:"Portrait",pageSize:"A4",pageWidth:-1,pageHeiht:-1,title:"",background:!0,pageOffset:0,toc:!0,tocHeaderText:"",tocDisableDottedLine:!1,tocLevelIndentation:-1,tocCustomStyle:"",outline:!0,outlineDepth:4,footerCenter:"[page]/[toPage]",footerLeft:"",footerRight:"",footerFontName:"Arial",footerFontSize:10,footerLine:!1,footerSpacing:0,headerCenter:"[section]",headerLeft:"",headerRight:"",headerFontName:"Arial",headerFontSize:10,headerLine:!0,headerSpacing:3,password:"",cover:!0,coverTitle:"",coverTitleFont:"bold 2em/1.2 serif",coverTitleFontColor:"#000000",coverSubTitle:"",coverSubTitleFont:"1.5em/1.1 sans-serif",coverSubTitleFontColor:"#000000",coverAuthor:"",coverAuthorFont:"0.8em/1 serif",coverAuthorFontColor:"#bbbbbb",coverImagePath:"",coverImageMD5:"",watermarker:!0,watermarkerLetters:"",watermarkerLettersFont:"bold 2em/1 serif",watermarkerLettersFontColor:"#000",watermarkerPosition:"mc",watermarkerPositionXOffset:0,watermarkerPositionYOffset:0,watermarkerAngle:315,watermarkerOpacity:1,waterImagePath:""},Bo=function(b,w,h,p,S,A,N,D){var s;b=b||{};const L=((s=b.user)==null?void 0:s.token)||"",B=b.authorizationHost||"";S=Object.assign({},ko,S);const Q=$("<div></div>");Q.html(w),Ro(Q);const K={},H=N.showProgressInfo||function(){},ee=N.isCancel||function(){return!1};if(S.coverImage&&S.coverImageMD5){const c=Be.dataURL2Blob(S.coverImage),a=S.coverImage.split(";")[0];S.coverImage="",c.size>Pt.maxFilesize?S.coverImageMD5="":(S.coverImageForMD5Prefix=a,K[S.coverImageMD5]=c)}let oe=0;const he=function(c,a){const u=$(c),l=c.src||"",y=function(){H(`(1/3) Converting imgs [${oe++}/${z.length}] ...`),a()};qo(A)(l,function(pe){if(!pe){c.src="",y();return}if(ee()){y();return}if(/svg/i.test(c.dataset.filetype)){pe.indexOf("data:image/svg")===0?(Wr(c,pe),y()):Be.urlToDataURL(pe,function(J,X){X&&(Wr(c,X),y())});return}const Ce=function(J){if(!J||ee()){y();return}return Be.blobToMd5(J,function(X,Y){return Y&&(K[Y]=J,c.src="",J.size>Pt.maxFilesize?H("filesize too big, system will ignore it","error",{el:c,size:J.size}):(u.attr("data-export-pdf-md5",Y),u.attr("data-export-pdf",!0))),y()})};if(/webp|gif/i.test(c.dataset.filetype)){Lo(c,Ce);return}Be.urlToBlob(pe,Ce)})},q=function(c,a){if(ee())return D("cancel");if(c==null&&(c="0"),a==null&&(a=0),a>10){D("upload fail by max limit");return}const u=1,l={fragment:Q.html(),style:p,access_token:L,authorization_host_string:B,title:h,config:JSON.stringify(S),resourceMD5s:Object.keys(K),ignoreResource:c,resourceCacheVersion:u},y=JSON.stringify(l),de=new Blob([y]);return c==="0"&&H(`(2/3) Uploading html and process pdf [${filesize(de.size)}]...`),$.ajax({url:`${Pt.host}/pdf-server/vipexportpdffile`,type:"POST",data:l,success:function(pe,Ce,J){if(!pe||ee())return D(JSON.stringify(pe));if(pe.uuid)return H(`(3/3) Downloading Pdf ${filesize(pe.filesize)} ...`),D(null,pe,`${Pt.host}/getpdffile?uuid=${pe.uuid}`,pe);if(pe.resourceIds&&pe.resourceIds.length>0){oe=0,H(`(2/3) Uploading imgs [${oe}/${pe.resourceIds.length}] ...`);const X=function(ae,ce){const ge=K[ae],ye=function(){ge&&H(`(2/3) Uploading imgs [${oe++}/${pe.resourceIds.length}] ${filesize(ge.size)}...`),ce()};if(!ge||ee())return ye();const Ie=new FormData,tt=new File([ge],ae);return Ie.append("resourcefile",tt),Ie.append("md5",ae),Ie.append("access_token",L),Ie.append("authorization_host_string",B),Ie.append("resource_cache_version",u),$.ajax({url:`${Pt.host}/pdf-server/uploadresource`,type:"POST",data:Ie,processData:!1,contentType:!1,success:function(ke,dt,rt){return ye()},error:function(ke,dt){return ye()}})},Y=function(){H("(3/3) Processing Pdf  ..."),q("1",++a)};return async.mapSeries(pe.resourceIds,X,Y)}return D(JSON.stringify(pe))},error:function(pe,Ce){return D(Ce)}})},z=Q.find("img").toArray();return H(`(1/3) Converting imgs [${oe}/${z.length}] ...`),async.mapLimit(z,20,he,function(){return q("0",0)})};(function(b){if(typeof Xr=="object"&&typeof Fn<"u")Fn.exports=b();else if(typeof define=="function"&&define.amd)define([],b);else{var w;typeof window<"u"?w=window:typeof global<"u"?w=global:typeof self<"u"?w=self:w=this,w.PouchDB=b()}})(function(){return function(){function b(w,h,p){function S(D,L){if(!h[D]){if(!w[D]){var B=typeof require=="function"&&require;if(!L&&B)return B(D,!0);if(A)return A(D,!0);var Q=new Error("Cannot find module '"+D+"'");throw Q.code="MODULE_NOT_FOUND",Q}var K=h[D]={exports:{}};w[D][0].call(K.exports,function(H){var ee=w[D][1][H];return S(ee||H)},K,K.exports,b,w,h,p)}return h[D].exports}for(var A=typeof require=="function"&&require,N=0;N<p.length;N++)S(p[N]);return S}return b}()({1:[function(b,w,h){w.exports=p;function p(S){return function(){var A=arguments.length;if(A){for(var N=[],D=-1;++D<A;)N[D]=arguments[D];return S.call(this,N)}else return S.call(this,[])}}},{}],2:[function(b,w,h){},{}],3:[function(b,w,h){var p=Object.create||de,S=Object.keys||pe,A=Function.prototype.bind||Ce;function N(){(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events"))&&(this._events=p(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}w.exports=N,N.EventEmitter=N,N.prototype._events=void 0,N.prototype._maxListeners=void 0;var D=10,L;try{var B={};Object.defineProperty&&Object.defineProperty(B,"x",{value:0}),L=B.x===0}catch{L=!1}L?Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return D},set:function(J){if(typeof J!="number"||J<0||J!==J)throw new TypeError('"defaultMaxListeners" must be a positive number');D=J}}):N.defaultMaxListeners=D,N.prototype.setMaxListeners=function(X){if(typeof X!="number"||X<0||isNaN(X))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=X,this};function Q(J){return J._maxListeners===void 0?N.defaultMaxListeners:J._maxListeners}N.prototype.getMaxListeners=function(){return Q(this)};function K(J,X,Y){if(X)J.call(Y);else for(var ae=J.length,ce=l(J,ae),ge=0;ge<ae;++ge)ce[ge].call(Y)}function H(J,X,Y,ae){if(X)J.call(Y,ae);else for(var ce=J.length,ge=l(J,ce),ye=0;ye<ce;++ye)ge[ye].call(Y,ae)}function ee(J,X,Y,ae,ce){if(X)J.call(Y,ae,ce);else for(var ge=J.length,ye=l(J,ge),Ie=0;Ie<ge;++Ie)ye[Ie].call(Y,ae,ce)}function oe(J,X,Y,ae,ce,ge){if(X)J.call(Y,ae,ce,ge);else for(var ye=J.length,Ie=l(J,ye),tt=0;tt<ye;++tt)Ie[tt].call(Y,ae,ce,ge)}function he(J,X,Y,ae){if(X)J.apply(Y,ae);else for(var ce=J.length,ge=l(J,ce),ye=0;ye<ce;++ye)ge[ye].apply(Y,ae)}N.prototype.emit=function(X){var Y,ae,ce,ge,ye,Ie,tt=X==="error";if(Ie=this._events,Ie)tt=tt&&Ie.error==null;else if(!tt)return!1;if(tt){if(arguments.length>1&&(Y=arguments[1]),Y instanceof Error)throw Y;var ke=new Error('Unhandled "error" event. ('+Y+")");throw ke.context=Y,ke}if(ae=Ie[X],!ae)return!1;var dt=typeof ae=="function";switch(ce=arguments.length,ce){case 1:K(ae,dt,this);break;case 2:H(ae,dt,this,arguments[1]);break;case 3:ee(ae,dt,this,arguments[1],arguments[2]);break;case 4:oe(ae,dt,this,arguments[1],arguments[2],arguments[3]);break;default:for(ge=new Array(ce-1),ye=1;ye<ce;ye++)ge[ye-1]=arguments[ye];he(ae,dt,this,ge)}return!0};function q(J,X,Y,ae){var ce,ge,ye;if(typeof Y!="function")throw new TypeError('"listener" argument must be a function');if(ge=J._events,ge?(ge.newListener&&(J.emit("newListener",X,Y.listener?Y.listener:Y),ge=J._events),ye=ge[X]):(ge=J._events=p(null),J._eventsCount=0),!ye)ye=ge[X]=Y,++J._eventsCount;else if(typeof ye=="function"?ye=ge[X]=ae?[Y,ye]:[ye,Y]:ae?ye.unshift(Y):ye.push(Y),!ye.warned&&(ce=Q(J),ce&&ce>0&&ye.length>ce)){ye.warned=!0;var Ie=new Error("Possible EventEmitter memory leak detected. "+ye.length+' "'+String(X)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');Ie.name="MaxListenersExceededWarning",Ie.emitter=J,Ie.type=X,Ie.count=ye.length}return J}N.prototype.addListener=function(X,Y){return q(this,X,Y,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(X,Y){return q(this,X,Y,!0)};function z(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var J=new Array(arguments.length),X=0;X<J.length;++X)J[X]=arguments[X];this.listener.apply(this.target,J)}}function s(J,X,Y){var ae={fired:!1,wrapFn:void 0,target:J,type:X,listener:Y},ce=A.call(z,ae);return ce.listener=Y,ae.wrapFn=ce,ce}N.prototype.once=function(X,Y){if(typeof Y!="function")throw new TypeError('"listener" argument must be a function');return this.on(X,s(this,X,Y)),this},N.prototype.prependOnceListener=function(X,Y){if(typeof Y!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(X,s(this,X,Y)),this},N.prototype.removeListener=function(X,Y){var ae,ce,ge,ye,Ie;if(typeof Y!="function")throw new TypeError('"listener" argument must be a function');if(ce=this._events,!ce)return this;if(ae=ce[X],!ae)return this;if(ae===Y||ae.listener===Y)--this._eventsCount===0?this._events=p(null):(delete ce[X],ce.removeListener&&this.emit("removeListener",X,ae.listener||Y));else if(typeof ae!="function"){for(ge=-1,ye=ae.length-1;ye>=0;ye--)if(ae[ye]===Y||ae[ye].listener===Y){Ie=ae[ye].listener,ge=ye;break}if(ge<0)return this;ge===0?ae.shift():u(ae,ge),ae.length===1&&(ce[X]=ae[0]),ce.removeListener&&this.emit("removeListener",X,Ie||Y)}return this},N.prototype.removeAllListeners=function(X){var Y,ae,ce;if(ae=this._events,!ae)return this;if(!ae.removeListener)return arguments.length===0?(this._events=p(null),this._eventsCount=0):ae[X]&&(--this._eventsCount===0?this._events=p(null):delete ae[X]),this;if(arguments.length===0){var ge=S(ae),ye;for(ce=0;ce<ge.length;++ce)ye=ge[ce],ye!=="removeListener"&&this.removeAllListeners(ye);return this.removeAllListeners("removeListener"),this._events=p(null),this._eventsCount=0,this}if(Y=ae[X],typeof Y=="function")this.removeListener(X,Y);else if(Y)for(ce=Y.length-1;ce>=0;ce--)this.removeListener(X,Y[ce]);return this};function c(J,X,Y){var ae=J._events;if(!ae)return[];var ce=ae[X];return ce?typeof ce=="function"?Y?[ce.listener||ce]:[ce]:Y?y(ce):l(ce,ce.length):[]}N.prototype.listeners=function(X){return c(this,X,!0)},N.prototype.rawListeners=function(X){return c(this,X,!1)},N.listenerCount=function(J,X){return typeof J.listenerCount=="function"?J.listenerCount(X):a.call(J,X)},N.prototype.listenerCount=a;function a(J){var X=this._events;if(X){var Y=X[J];if(typeof Y=="function")return 1;if(Y)return Y.length}return 0}N.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function u(J,X){for(var Y=X,ae=Y+1,ce=J.length;ae<ce;Y+=1,ae+=1)J[Y]=J[ae];J.pop()}function l(J,X){for(var Y=new Array(X),ae=0;ae<X;++ae)Y[ae]=J[ae];return Y}function y(J){for(var X=new Array(J.length),Y=0;Y<X.length;++Y)X[Y]=J[Y].listener||J[Y];return X}function de(J){var X=function(){};return X.prototype=J,new X}function pe(J){for(var X in J)Object.prototype.hasOwnProperty.call(J,X);return X}function Ce(J){var X=this;return function(){return X.apply(J,arguments)}}},{}],4:[function(b,w,h){var p=[b(2),b(7),b(6),b(5),b(8),b(9)],S,A,N=-1,D=[],L=!1;function B(){!S||!A||(S=!1,A.length?D=A.concat(D):N=-1,D.length&&Q())}function Q(){if(!S){L=!1,S=!0;for(var q=D.length,z=setTimeout(B);q;){for(A=D,D=[];A&&++N<q;)A[N].run();N=-1,q=D.length}A=null,N=-1,S=!1,clearTimeout(z)}}for(var K,H=-1,ee=p.length;++H<ee;)if(p[H]&&p[H].test&&p[H].test()){K=p[H].install(Q);break}function oe(q,z){this.fun=q,this.array=z}oe.prototype.run=function(){var q=this.fun,z=this.array;switch(z.length){case 0:return q();case 1:return q(z[0]);case 2:return q(z[0],z[1]);case 3:return q(z[0],z[1],z[2]);default:return q.apply(null,z)}},w.exports=he;function he(q){var z=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)z[s-1]=arguments[s];D.push(new oe(q,z)),!L&&!S&&(L=!0,K())}},{2:2,5:5,6:6,7:7,8:8,9:9}],5:[function(b,w,h){(function(p){(function(){h.test=function(){return p.setImmediate?!1:typeof p.MessageChannel<"u"},h.install=function(S){var A=new p.MessageChannel;return A.port1.onmessage=S,function(){A.port2.postMessage(0)}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],6:[function(b,w,h){(function(p){(function(){var S=p.MutationObserver||p.WebKitMutationObserver;h.test=function(){return S},h.install=function(A){var N=0,D=new S(A),L=p.document.createTextNode("");return D.observe(L,{characterData:!0}),function(){L.data=N=++N%2}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],7:[function(b,w,h){(function(p){(function(){h.test=function(){return typeof p.queueMicrotask=="function"},h.install=function(S){return function(){p.queueMicrotask(S)}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],8:[function(b,w,h){(function(p){(function(){h.test=function(){return"document"in p&&"onreadystatechange"in p.document.createElement("script")},h.install=function(S){return function(){var A=p.document.createElement("script");return A.onreadystatechange=function(){S(),A.onreadystatechange=null,A.parentNode.removeChild(A),A=null},p.document.documentElement.appendChild(A),S}}}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],9:[function(b,w,h){h.test=function(){return!0},h.install=function(p){return function(){setTimeout(p,0)}}},{}],10:[function(b,w,h){typeof Object.create=="function"?w.exports=function(S,A){A&&(S.super_=A,S.prototype=Object.create(A.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}))}:w.exports=function(S,A){if(A){S.super_=A;var N=function(){};N.prototype=A.prototype,S.prototype=new N,S.prototype.constructor=S}}},{}],11:[function(b,w,h){var p=w.exports={},S,A;function N(){throw new Error("setTimeout has not been defined")}function D(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?S=setTimeout:S=N}catch{S=N}try{typeof clearTimeout=="function"?A=clearTimeout:A=D}catch{A=D}})();function L(s){if(S===setTimeout)return setTimeout(s,0);if((S===N||!S)&&setTimeout)return S=setTimeout,setTimeout(s,0);try{return S(s,0)}catch{try{return S.call(null,s,0)}catch{return S.call(this,s,0)}}}function B(s){if(A===clearTimeout)return clearTimeout(s);if((A===D||!A)&&clearTimeout)return A=clearTimeout,clearTimeout(s);try{return A(s)}catch{try{return A.call(null,s)}catch{return A.call(this,s)}}}var Q=[],K=!1,H,ee=-1;function oe(){!K||!H||(K=!1,H.length?Q=H.concat(Q):ee=-1,Q.length&&he())}function he(){if(!K){var s=L(oe);K=!0;for(var c=Q.length;c;){for(H=Q,Q=[];++ee<c;)H&&H[ee].run();ee=-1,c=Q.length}H=null,K=!1,B(s)}}p.nextTick=function(s){var c=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)c[a-1]=arguments[a];Q.push(new q(s,c)),Q.length===1&&!K&&L(he)};function q(s,c){this.fun=s,this.array=c}q.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={};function z(){}p.on=z,p.addListener=z,p.once=z,p.off=z,p.removeListener=z,p.removeAllListeners=z,p.emit=z,p.prependListener=z,p.prependOnceListener=z,p.listeners=function(s){return[]},p.binding=function(s){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(s){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],12:[function(b,w,h){(function(p){if(typeof h=="object")w.exports=p();else{var S;try{S=window}catch{S=self}S.SparkMD5=p()}})(function(p){var S=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function A(s,c){var a=s[0],u=s[1],l=s[2],y=s[3];a+=(u&l|~u&y)+c[0]-680876936|0,a=(a<<7|a>>>25)+u|0,y+=(a&u|~a&l)+c[1]-389564586|0,y=(y<<12|y>>>20)+a|0,l+=(y&a|~y&u)+c[2]+606105819|0,l=(l<<17|l>>>15)+y|0,u+=(l&y|~l&a)+c[3]-1044525330|0,u=(u<<22|u>>>10)+l|0,a+=(u&l|~u&y)+c[4]-176418897|0,a=(a<<7|a>>>25)+u|0,y+=(a&u|~a&l)+c[5]+1200080426|0,y=(y<<12|y>>>20)+a|0,l+=(y&a|~y&u)+c[6]-1473231341|0,l=(l<<17|l>>>15)+y|0,u+=(l&y|~l&a)+c[7]-45705983|0,u=(u<<22|u>>>10)+l|0,a+=(u&l|~u&y)+c[8]+1770035416|0,a=(a<<7|a>>>25)+u|0,y+=(a&u|~a&l)+c[9]-1958414417|0,y=(y<<12|y>>>20)+a|0,l+=(y&a|~y&u)+c[10]-42063|0,l=(l<<17|l>>>15)+y|0,u+=(l&y|~l&a)+c[11]-1990404162|0,u=(u<<22|u>>>10)+l|0,a+=(u&l|~u&y)+c[12]+1804603682|0,a=(a<<7|a>>>25)+u|0,y+=(a&u|~a&l)+c[13]-40341101|0,y=(y<<12|y>>>20)+a|0,l+=(y&a|~y&u)+c[14]-1502002290|0,l=(l<<17|l>>>15)+y|0,u+=(l&y|~l&a)+c[15]+1236535329|0,u=(u<<22|u>>>10)+l|0,a+=(u&y|l&~y)+c[1]-165796510|0,a=(a<<5|a>>>27)+u|0,y+=(a&l|u&~l)+c[6]-1069501632|0,y=(y<<9|y>>>23)+a|0,l+=(y&u|a&~u)+c[11]+643717713|0,l=(l<<14|l>>>18)+y|0,u+=(l&a|y&~a)+c[0]-373897302|0,u=(u<<20|u>>>12)+l|0,a+=(u&y|l&~y)+c[5]-701558691|0,a=(a<<5|a>>>27)+u|0,y+=(a&l|u&~l)+c[10]+38016083|0,y=(y<<9|y>>>23)+a|0,l+=(y&u|a&~u)+c[15]-660478335|0,l=(l<<14|l>>>18)+y|0,u+=(l&a|y&~a)+c[4]-405537848|0,u=(u<<20|u>>>12)+l|0,a+=(u&y|l&~y)+c[9]+568446438|0,a=(a<<5|a>>>27)+u|0,y+=(a&l|u&~l)+c[14]-1019803690|0,y=(y<<9|y>>>23)+a|0,l+=(y&u|a&~u)+c[3]-187363961|0,l=(l<<14|l>>>18)+y|0,u+=(l&a|y&~a)+c[8]+1163531501|0,u=(u<<20|u>>>12)+l|0,a+=(u&y|l&~y)+c[13]-1444681467|0,a=(a<<5|a>>>27)+u|0,y+=(a&l|u&~l)+c[2]-51403784|0,y=(y<<9|y>>>23)+a|0,l+=(y&u|a&~u)+c[7]+1735328473|0,l=(l<<14|l>>>18)+y|0,u+=(l&a|y&~a)+c[12]-1926607734|0,u=(u<<20|u>>>12)+l|0,a+=(u^l^y)+c[5]-378558|0,a=(a<<4|a>>>28)+u|0,y+=(a^u^l)+c[8]-2022574463|0,y=(y<<11|y>>>21)+a|0,l+=(y^a^u)+c[11]+1839030562|0,l=(l<<16|l>>>16)+y|0,u+=(l^y^a)+c[14]-35309556|0,u=(u<<23|u>>>9)+l|0,a+=(u^l^y)+c[1]-1530992060|0,a=(a<<4|a>>>28)+u|0,y+=(a^u^l)+c[4]+1272893353|0,y=(y<<11|y>>>21)+a|0,l+=(y^a^u)+c[7]-155497632|0,l=(l<<16|l>>>16)+y|0,u+=(l^y^a)+c[10]-1094730640|0,u=(u<<23|u>>>9)+l|0,a+=(u^l^y)+c[13]+681279174|0,a=(a<<4|a>>>28)+u|0,y+=(a^u^l)+c[0]-358537222|0,y=(y<<11|y>>>21)+a|0,l+=(y^a^u)+c[3]-722521979|0,l=(l<<16|l>>>16)+y|0,u+=(l^y^a)+c[6]+76029189|0,u=(u<<23|u>>>9)+l|0,a+=(u^l^y)+c[9]-640364487|0,a=(a<<4|a>>>28)+u|0,y+=(a^u^l)+c[12]-421815835|0,y=(y<<11|y>>>21)+a|0,l+=(y^a^u)+c[15]+530742520|0,l=(l<<16|l>>>16)+y|0,u+=(l^y^a)+c[2]-995338651|0,u=(u<<23|u>>>9)+l|0,a+=(l^(u|~y))+c[0]-198630844|0,a=(a<<6|a>>>26)+u|0,y+=(u^(a|~l))+c[7]+1126891415|0,y=(y<<10|y>>>22)+a|0,l+=(a^(y|~u))+c[14]-1416354905|0,l=(l<<15|l>>>17)+y|0,u+=(y^(l|~a))+c[5]-57434055|0,u=(u<<21|u>>>11)+l|0,a+=(l^(u|~y))+c[12]+1700485571|0,a=(a<<6|a>>>26)+u|0,y+=(u^(a|~l))+c[3]-1894986606|0,y=(y<<10|y>>>22)+a|0,l+=(a^(y|~u))+c[10]-1051523|0,l=(l<<15|l>>>17)+y|0,u+=(y^(l|~a))+c[1]-2054922799|0,u=(u<<21|u>>>11)+l|0,a+=(l^(u|~y))+c[8]+1873313359|0,a=(a<<6|a>>>26)+u|0,y+=(u^(a|~l))+c[15]-30611744|0,y=(y<<10|y>>>22)+a|0,l+=(a^(y|~u))+c[6]-1560198380|0,l=(l<<15|l>>>17)+y|0,u+=(y^(l|~a))+c[13]+1309151649|0,u=(u<<21|u>>>11)+l|0,a+=(l^(u|~y))+c[4]-145523070|0,a=(a<<6|a>>>26)+u|0,y+=(u^(a|~l))+c[11]-1120210379|0,y=(y<<10|y>>>22)+a|0,l+=(a^(y|~u))+c[2]+718787259|0,l=(l<<15|l>>>17)+y|0,u+=(y^(l|~a))+c[9]-343485551|0,u=(u<<21|u>>>11)+l|0,s[0]=a+s[0]|0,s[1]=u+s[1]|0,s[2]=l+s[2]|0,s[3]=y+s[3]|0}function N(s){var c=[],a;for(a=0;a<64;a+=4)c[a>>2]=s.charCodeAt(a)+(s.charCodeAt(a+1)<<8)+(s.charCodeAt(a+2)<<16)+(s.charCodeAt(a+3)<<24);return c}function D(s){var c=[],a;for(a=0;a<64;a+=4)c[a>>2]=s[a]+(s[a+1]<<8)+(s[a+2]<<16)+(s[a+3]<<24);return c}function L(s){var c=s.length,a=[1732584193,-271733879,-1732584194,271733878],u,l,y,de,pe,Ce;for(u=64;u<=c;u+=64)A(a,N(s.substring(u-64,u)));for(s=s.substring(u-64),l=s.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)y[u>>2]|=s.charCodeAt(u)<<(u%4<<3);if(y[u>>2]|=128<<(u%4<<3),u>55)for(A(a,y),u=0;u<16;u+=1)y[u]=0;return de=c*8,de=de.toString(16).match(/(.*?)(.{0,8})$/),pe=parseInt(de[2],16),Ce=parseInt(de[1],16)||0,y[14]=pe,y[15]=Ce,A(a,y),a}function B(s){var c=s.length,a=[1732584193,-271733879,-1732584194,271733878],u,l,y,de,pe,Ce;for(u=64;u<=c;u+=64)A(a,D(s.subarray(u-64,u)));for(s=u-64<c?s.subarray(u-64):new Uint8Array(0),l=s.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)y[u>>2]|=s[u]<<(u%4<<3);if(y[u>>2]|=128<<(u%4<<3),u>55)for(A(a,y),u=0;u<16;u+=1)y[u]=0;return de=c*8,de=de.toString(16).match(/(.*?)(.{0,8})$/),pe=parseInt(de[2],16),Ce=parseInt(de[1],16)||0,y[14]=pe,y[15]=Ce,A(a,y),a}function Q(s){var c="",a;for(a=0;a<4;a+=1)c+=S[s>>a*8+4&15]+S[s>>a*8&15];return c}function K(s){var c;for(c=0;c<s.length;c+=1)s[c]=Q(s[c]);return s.join("")}K(L("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function s(c,a){return c=c|0||0,c<0?Math.max(c+a,0):Math.min(c,a)}ArrayBuffer.prototype.slice=function(c,a){var u=this.byteLength,l=s(c,u),y=u,de,pe,Ce,J;return a!==p&&(y=s(a,u)),l>y?new ArrayBuffer(0):(de=y-l,pe=new ArrayBuffer(de),Ce=new Uint8Array(pe),J=new Uint8Array(this,l,de),Ce.set(J),pe)}}();function H(s){return/[\u0080-\uFFFF]/.test(s)&&(s=unescape(encodeURIComponent(s))),s}function ee(s,c){var a=s.length,u=new ArrayBuffer(a),l=new Uint8Array(u),y;for(y=0;y<a;y+=1)l[y]=s.charCodeAt(y);return c?l:u}function oe(s){return String.fromCharCode.apply(null,new Uint8Array(s))}function he(s,c,a){var u=new Uint8Array(s.byteLength+c.byteLength);return u.set(new Uint8Array(s)),u.set(new Uint8Array(c),s.byteLength),a?u:u.buffer}function q(s){var c=[],a=s.length,u;for(u=0;u<a-1;u+=2)c.push(parseInt(s.substr(u,2),16));return String.fromCharCode.apply(String,c)}function z(){this.reset()}return z.prototype.append=function(s){return this.appendBinary(H(s)),this},z.prototype.appendBinary=function(s){this._buff+=s,this._length+=s.length;var c=this._buff.length,a;for(a=64;a<=c;a+=64)A(this._hash,N(this._buff.substring(a-64,a)));return this._buff=this._buff.substring(a-64),this},z.prototype.end=function(s){var c=this._buff,a=c.length,u,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y;for(u=0;u<a;u+=1)l[u>>2]|=c.charCodeAt(u)<<(u%4<<3);return this._finish(l,a),y=K(this._hash),s&&(y=q(y)),this.reset(),y},z.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},z.prototype.setState=function(s){return this._buff=s.buff,this._length=s.length,this._hash=s.hash,this},z.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},z.prototype._finish=function(s,c){var a=c,u,l,y;if(s[a>>2]|=128<<(a%4<<3),a>55)for(A(this._hash,s),a=0;a<16;a+=1)s[a]=0;u=this._length*8,u=u.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(u[2],16),y=parseInt(u[1],16)||0,s[14]=l,s[15]=y,A(this._hash,s)},z.hash=function(s,c){return z.hashBinary(H(s),c)},z.hashBinary=function(s,c){var a=L(s),u=K(a);return c?q(u):u},z.ArrayBuffer=function(){this.reset()},z.ArrayBuffer.prototype.append=function(s){var c=he(this._buff.buffer,s,!0),a=c.length,u;for(this._length+=s.byteLength,u=64;u<=a;u+=64)A(this._hash,D(c.subarray(u-64,u)));return this._buff=u-64<a?new Uint8Array(c.buffer.slice(u-64)):new Uint8Array(0),this},z.ArrayBuffer.prototype.end=function(s){var c=this._buff,a=c.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,y;for(l=0;l<a;l+=1)u[l>>2]|=c[l]<<(l%4<<3);return this._finish(u,a),y=K(this._hash),s&&(y=q(y)),this.reset(),y},z.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.ArrayBuffer.prototype.getState=function(){var s=z.prototype.getState.call(this);return s.buff=oe(s.buff),s},z.ArrayBuffer.prototype.setState=function(s){return s.buff=ee(s.buff,!0),z.prototype.setState.call(this,s)},z.ArrayBuffer.prototype.destroy=z.prototype.destroy,z.ArrayBuffer.prototype._finish=z.prototype._finish,z.ArrayBuffer.hash=function(s,c){var a=B(new Uint8Array(s)),u=K(a);return c?q(u):u},z})},{}],13:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),Object.defineProperty(h,"v1",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(h,"v3",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(h,"v4",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(h,"v5",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(h,"NIL",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(h,"version",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(h,"validate",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(h,"stringify",{enumerable:!0,get:function(){return Q.default}}),Object.defineProperty(h,"parse",{enumerable:!0,get:function(){return K.default}});var p=H(b(21)),S=H(b(22)),A=H(b(24)),N=H(b(25)),D=H(b(15)),L=H(b(27)),B=H(b(26)),Q=H(b(20)),K=H(b(16));function H(ee){return ee&&ee.__esModule?ee:{default:ee}}},{15:15,16:16,20:20,21:21,22:22,24:24,25:25,26:26,27:27}],14:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;function p(q){if(typeof q=="string"){const z=unescape(encodeURIComponent(q));q=new Uint8Array(z.length);for(let s=0;s<z.length;++s)q[s]=z.charCodeAt(s)}return S(N(D(q),q.length*8))}function S(q){const z=[],s=q.length*32,c="0123456789abcdef";for(let a=0;a<s;a+=8){const u=q[a>>5]>>>a%32&255,l=parseInt(c.charAt(u>>>4&15)+c.charAt(u&15),16);z.push(l)}return z}function A(q){return(q+64>>>9<<4)+14+1}function N(q,z){q[z>>5]|=128<<z%32,q[A(z)-1]=z;let s=1732584193,c=-271733879,a=-1732584194,u=271733878;for(let l=0;l<q.length;l+=16){const y=s,de=c,pe=a,Ce=u;s=K(s,c,a,u,q[l],7,-680876936),u=K(u,s,c,a,q[l+1],12,-389564586),a=K(a,u,s,c,q[l+2],17,606105819),c=K(c,a,u,s,q[l+3],22,-1044525330),s=K(s,c,a,u,q[l+4],7,-176418897),u=K(u,s,c,a,q[l+5],12,1200080426),a=K(a,u,s,c,q[l+6],17,-1473231341),c=K(c,a,u,s,q[l+7],22,-45705983),s=K(s,c,a,u,q[l+8],7,1770035416),u=K(u,s,c,a,q[l+9],12,-1958414417),a=K(a,u,s,c,q[l+10],17,-42063),c=K(c,a,u,s,q[l+11],22,-1990404162),s=K(s,c,a,u,q[l+12],7,1804603682),u=K(u,s,c,a,q[l+13],12,-40341101),a=K(a,u,s,c,q[l+14],17,-1502002290),c=K(c,a,u,s,q[l+15],22,1236535329),s=H(s,c,a,u,q[l+1],5,-165796510),u=H(u,s,c,a,q[l+6],9,-1069501632),a=H(a,u,s,c,q[l+11],14,643717713),c=H(c,a,u,s,q[l],20,-373897302),s=H(s,c,a,u,q[l+5],5,-701558691),u=H(u,s,c,a,q[l+10],9,38016083),a=H(a,u,s,c,q[l+15],14,-660478335),c=H(c,a,u,s,q[l+4],20,-405537848),s=H(s,c,a,u,q[l+9],5,568446438),u=H(u,s,c,a,q[l+14],9,-1019803690),a=H(a,u,s,c,q[l+3],14,-187363961),c=H(c,a,u,s,q[l+8],20,1163531501),s=H(s,c,a,u,q[l+13],5,-1444681467),u=H(u,s,c,a,q[l+2],9,-51403784),a=H(a,u,s,c,q[l+7],14,1735328473),c=H(c,a,u,s,q[l+12],20,-1926607734),s=ee(s,c,a,u,q[l+5],4,-378558),u=ee(u,s,c,a,q[l+8],11,-2022574463),a=ee(a,u,s,c,q[l+11],16,1839030562),c=ee(c,a,u,s,q[l+14],23,-35309556),s=ee(s,c,a,u,q[l+1],4,-1530992060),u=ee(u,s,c,a,q[l+4],11,1272893353),a=ee(a,u,s,c,q[l+7],16,-155497632),c=ee(c,a,u,s,q[l+10],23,-1094730640),s=ee(s,c,a,u,q[l+13],4,681279174),u=ee(u,s,c,a,q[l],11,-358537222),a=ee(a,u,s,c,q[l+3],16,-722521979),c=ee(c,a,u,s,q[l+6],23,76029189),s=ee(s,c,a,u,q[l+9],4,-640364487),u=ee(u,s,c,a,q[l+12],11,-421815835),a=ee(a,u,s,c,q[l+15],16,530742520),c=ee(c,a,u,s,q[l+2],23,-995338651),s=oe(s,c,a,u,q[l],6,-198630844),u=oe(u,s,c,a,q[l+7],10,1126891415),a=oe(a,u,s,c,q[l+14],15,-1416354905),c=oe(c,a,u,s,q[l+5],21,-57434055),s=oe(s,c,a,u,q[l+12],6,1700485571),u=oe(u,s,c,a,q[l+3],10,-1894986606),a=oe(a,u,s,c,q[l+10],15,-1051523),c=oe(c,a,u,s,q[l+1],21,-2054922799),s=oe(s,c,a,u,q[l+8],6,1873313359),u=oe(u,s,c,a,q[l+15],10,-30611744),a=oe(a,u,s,c,q[l+6],15,-1560198380),c=oe(c,a,u,s,q[l+13],21,1309151649),s=oe(s,c,a,u,q[l+4],6,-145523070),u=oe(u,s,c,a,q[l+11],10,-1120210379),a=oe(a,u,s,c,q[l+2],15,718787259),c=oe(c,a,u,s,q[l+9],21,-343485551),s=L(s,y),c=L(c,de),a=L(a,pe),u=L(u,Ce)}return[s,c,a,u]}function D(q){if(q.length===0)return[];const z=q.length*8,s=new Uint32Array(A(z));for(let c=0;c<z;c+=8)s[c>>5]|=(q[c/8]&255)<<c%32;return s}function L(q,z){const s=(q&65535)+(z&65535);return(q>>16)+(z>>16)+(s>>16)<<16|s&65535}function B(q,z){return q<<z|q>>>32-z}function Q(q,z,s,c,a,u){return L(B(L(L(z,q),L(c,u)),a),s)}function K(q,z,s,c,a,u,l){return Q(z&s|~z&c,q,z,a,u,l)}function H(q,z,s,c,a,u,l){return Q(z&c|s&~c,q,z,a,u,l)}function ee(q,z,s,c,a,u,l){return Q(z^s^c,q,z,a,u,l)}function oe(q,z,s,c,a,u,l){return Q(s^(z|~c),q,z,a,u,l)}var he=p;h.default=he},{}],15:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p="00000000-0000-0000-0000-000000000000";h.default=p},{}],16:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=S(b(26));function S(D){return D&&D.__esModule?D:{default:D}}function A(D){if(!(0,p.default)(D))throw TypeError("Invalid UUID");let L;const B=new Uint8Array(16);return B[0]=(L=parseInt(D.slice(0,8),16))>>>24,B[1]=L>>>16&255,B[2]=L>>>8&255,B[3]=L&255,B[4]=(L=parseInt(D.slice(9,13),16))>>>8,B[5]=L&255,B[6]=(L=parseInt(D.slice(14,18),16))>>>8,B[7]=L&255,B[8]=(L=parseInt(D.slice(19,23),16))>>>8,B[9]=L&255,B[10]=(L=parseInt(D.slice(24,36),16))/1099511627776&255,B[11]=L/4294967296&255,B[12]=L>>>24&255,B[13]=L>>>16&255,B[14]=L>>>8&255,B[15]=L&255,B}var N=A;h.default=N},{26:26}],17:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;h.default=p},{}],18:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=A;let p;const S=new Uint8Array(16);function A(){if(!p&&(p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(S)}},{}],19:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;function p(D,L,B,Q){switch(D){case 0:return L&B^~L&Q;case 1:return L^B^Q;case 2:return L&B^L&Q^B&Q;case 3:return L^B^Q}}function S(D,L){return D<<L|D>>>32-L}function A(D){const L=[1518500249,1859775393,2400959708,3395469782],B=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof D=="string"){const ee=unescape(encodeURIComponent(D));D=[];for(let oe=0;oe<ee.length;++oe)D.push(ee.charCodeAt(oe))}else Array.isArray(D)||(D=Array.prototype.slice.call(D));D.push(128);const Q=D.length/4+2,K=Math.ceil(Q/16),H=new Array(K);for(let ee=0;ee<K;++ee){const oe=new Uint32Array(16);for(let he=0;he<16;++he)oe[he]=D[ee*64+he*4]<<24|D[ee*64+he*4+1]<<16|D[ee*64+he*4+2]<<8|D[ee*64+he*4+3];H[ee]=oe}H[K-1][14]=(D.length-1)*8/Math.pow(2,32),H[K-1][14]=Math.floor(H[K-1][14]),H[K-1][15]=(D.length-1)*8&4294967295;for(let ee=0;ee<K;++ee){const oe=new Uint32Array(80);for(let a=0;a<16;++a)oe[a]=H[ee][a];for(let a=16;a<80;++a)oe[a]=S(oe[a-3]^oe[a-8]^oe[a-14]^oe[a-16],1);let he=B[0],q=B[1],z=B[2],s=B[3],c=B[4];for(let a=0;a<80;++a){const u=Math.floor(a/20),l=S(he,5)+p(u,q,z,s)+c+L[u]+oe[a]>>>0;c=s,s=z,z=S(q,30)>>>0,q=he,he=l}B[0]=B[0]+he>>>0,B[1]=B[1]+q>>>0,B[2]=B[2]+z>>>0,B[3]=B[3]+s>>>0,B[4]=B[4]+c>>>0}return[B[0]>>24&255,B[0]>>16&255,B[0]>>8&255,B[0]&255,B[1]>>24&255,B[1]>>16&255,B[1]>>8&255,B[1]&255,B[2]>>24&255,B[2]>>16&255,B[2]>>8&255,B[2]&255,B[3]>>24&255,B[3]>>16&255,B[3]>>8&255,B[3]&255,B[4]>>24&255,B[4]>>16&255,B[4]>>8&255,B[4]&255]}var N=A;h.default=N},{}],20:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=S(b(26));function S(L){return L&&L.__esModule?L:{default:L}}const A=[];for(let L=0;L<256;++L)A.push((L+256).toString(16).substr(1));function N(L,B=0){const Q=(A[L[B+0]]+A[L[B+1]]+A[L[B+2]]+A[L[B+3]]+"-"+A[L[B+4]]+A[L[B+5]]+"-"+A[L[B+6]]+A[L[B+7]]+"-"+A[L[B+8]]+A[L[B+9]]+"-"+A[L[B+10]]+A[L[B+11]]+A[L[B+12]]+A[L[B+13]]+A[L[B+14]]+A[L[B+15]]).toLowerCase();if(!(0,p.default)(Q))throw TypeError("Stringified UUID is invalid");return Q}var D=N;h.default=D},{26:26}],21:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=A(b(18)),S=A(b(20));function A(H){return H&&H.__esModule?H:{default:H}}let N,D,L=0,B=0;function Q(H,ee,oe){let he=ee&&oe||0;const q=ee||new Array(16);H=H||{};let z=H.node||N,s=H.clockseq!==void 0?H.clockseq:D;if(z==null||s==null){const de=H.random||(H.rng||p.default)();z==null&&(z=N=[de[0]|1,de[1],de[2],de[3],de[4],de[5]]),s==null&&(s=D=(de[6]<<8|de[7])&16383)}let c=H.msecs!==void 0?H.msecs:Date.now(),a=H.nsecs!==void 0?H.nsecs:B+1;const u=c-L+(a-B)/1e4;if(u<0&&H.clockseq===void 0&&(s=s+1&16383),(u<0||c>L)&&H.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");L=c,B=a,D=s,c+=122192928e5;const l=((c&268435455)*1e4+a)%4294967296;q[he++]=l>>>24&255,q[he++]=l>>>16&255,q[he++]=l>>>8&255,q[he++]=l&255;const y=c/4294967296*1e4&268435455;q[he++]=y>>>8&255,q[he++]=y&255,q[he++]=y>>>24&15|16,q[he++]=y>>>16&255,q[he++]=s>>>8|128,q[he++]=s&255;for(let de=0;de<6;++de)q[he+de]=z[de];return ee||(0,S.default)(q)}var K=Q;h.default=K},{18:18,20:20}],22:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=A(b(23)),S=A(b(14));function A(L){return L&&L.__esModule?L:{default:L}}var D=(0,p.default)("v3",48,S.default);h.default=D},{14:14,23:23}],23:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=B,h.URL=h.DNS=void 0;var p=A(b(20)),S=A(b(16));function A(Q){return Q&&Q.__esModule?Q:{default:Q}}function N(Q){Q=unescape(encodeURIComponent(Q));const K=[];for(let H=0;H<Q.length;++H)K.push(Q.charCodeAt(H));return K}const D="6ba7b810-9dad-11d1-80b4-00c04fd430c8";h.DNS=D;const L="6ba7b811-9dad-11d1-80b4-00c04fd430c8";h.URL=L;function B(Q,K,H){function ee(oe,he,q,z){if(typeof oe=="string"&&(oe=N(oe)),typeof he=="string"&&(he=(0,S.default)(he)),he.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let s=new Uint8Array(16+oe.length);if(s.set(he),s.set(oe,he.length),s=H(s),s[6]=s[6]&15|K,s[8]=s[8]&63|128,q){z=z||0;for(let c=0;c<16;++c)q[z+c]=s[c];return q}return(0,p.default)(s)}try{ee.name=Q}catch{}return ee.DNS=D,ee.URL=L,ee}},{16:16,20:20}],24:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=A(b(18)),S=A(b(20));function A(L){return L&&L.__esModule?L:{default:L}}function N(L,B,Q){L=L||{};const K=L.random||(L.rng||p.default)();if(K[6]=K[6]&15|64,K[8]=K[8]&63|128,B){Q=Q||0;for(let H=0;H<16;++H)B[Q+H]=K[H];return B}return(0,S.default)(K)}var D=N;h.default=D},{18:18,20:20}],25:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=A(b(23)),S=A(b(19));function A(L){return L&&L.__esModule?L:{default:L}}var D=(0,p.default)("v5",80,S.default);h.default=D},{19:19,23:23}],26:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=S(b(17));function S(D){return D&&D.__esModule?D:{default:D}}function A(D){return typeof D=="string"&&p.default.test(D)}var N=A;h.default=N},{17:17}],27:[function(b,w,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=S(b(26));function S(D){return D&&D.__esModule?D:{default:D}}function A(D){if(!(0,p.default)(D))throw TypeError("Invalid UUID");return parseInt(D.substr(14,1),16)}var N=A;h.default=N},{26:26}],28:[function(b,w,h){h.stringify=function(A){var N=[];N.push({obj:A});for(var D="",L,B,Q,K,H,ee,oe,he,q,z,s;L=N.pop();)if(B=L.obj,Q=L.prefix||"",K=L.val||"",D+=Q,K)D+=K;else if(typeof B!="object")D+=typeof B>"u"?null:JSON.stringify(B);else if(B===null)D+="null";else if(Array.isArray(B)){for(N.push({val:"]"}),H=B.length-1;H>=0;H--)ee=H===0?"":",",N.push({obj:B[H],prefix:ee});N.push({val:"["})}else{oe=[];for(he in B)B.hasOwnProperty(he)&&oe.push(he);for(N.push({val:"}"}),H=oe.length-1;H>=0;H--)q=oe[H],z=B[q],s=H>0?",":"",s+=JSON.stringify(q)+":",N.push({obj:z,prefix:s});N.push({val:"{"})}return D};function p(S,A,N){var D=N[N.length-1];S===D.element&&(N.pop(),D=N[N.length-1]);var L=D.element,B=D.index;if(Array.isArray(L))L.push(S);else if(B===A.length-2){var Q=A.pop();L[Q]=S}else A.push(S)}h.parse=function(S){for(var A=[],N=[],D=0,L,B,Q,K,H,ee,oe,he,q;;){if(L=S[D++],L==="}"||L==="]"||typeof L>"u"){if(A.length===1)return A.pop();p(A.pop(),A,N);continue}switch(L){case" ":case"	":case`
`:case":":case",":break;case"n":D+=3,p(null,A,N);break;case"t":D+=3,p(!0,A,N);break;case"f":D+=4,p(!1,A,N);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(B="",D--;;)if(Q=S[D++],/[\d\.\-e\+]/.test(Q))B+=Q;else{D--;break}p(parseFloat(B),A,N);break;case'"':for(K="",H=void 0,ee=0;oe=S[D++],oe!=='"'||H==="\\"&&ee%2===1;)K+=oe,H=oe,H==="\\"?ee++:ee=0;p(JSON.parse('"'+K+'"'),A,N);break;case"[":he={element:[],index:A.length},A.push(he.element),N.push(he);break;case"{":q={element:{},index:A.length},A.push(q.element),N.push(q);break;default:throw new Error("unexpectedly reached end of input: "+L)}}}},{}],29:[function(b,w,h){(function(p){(function(){function S(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var A=S(b(4)),N=b(13),D=S(b(12)),L=S(b(28)),B=S(b(1)),Q=S(b(10)),K=S(b(3));function H(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function ee(e){if(typeof e.slice=="function")return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function oe(e){if(e instanceof ArrayBuffer)return ee(e);var t=e.size,n=e.type;return typeof e.slice=="function"?e.slice(0,t,n):e.webkitSlice(0,t,n)}var he=Function.prototype.toString,q=he.call(Object);function z(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&he.call(n)==q}function s(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=s(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(H(e))return oe(e);if(!z(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=s(e[n]);typeof i<"u"&&(t[n]=i)}return t}function c(e){var t=!1;return B(function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)})}function a(e){return B(function(t){t=s(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(o,f){var v;try{var m=c(function(k,U){k?f(k):o(U)});t.push(m),v=e.apply(n,t),v&&typeof v.then=="function"&&o(v)}catch(k){f(k)}});return r&&i.then(function(o){r(null,o)},r),i})}function u(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(f,v){var m=["api",e.name,t];m=m.concat(f?["error",f]:["success",v]),e.constructor.emit("debug",m),o(f,v)}}}function l(e,t){return a(B(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return u(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,o){r.taskqueue.addTask(function(f){f?o(f):i(r[e].apply(r,n))})})}))}function y(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}var de=6;function pe(e){return e}function Ce(e){return[{ok:e}]}function J(e,t,n){var r=t.docs,i=new Map;r.forEach(function(O){i.has(O.id)?i.get(O.id).push(O):i.set(O.id,[O])});var o=i.size,f=0,v=new Array(o);function m(){var O=[];v.forEach(function(x){x.docs.forEach(function(j){O.push({id:x.id,docs:[j]})})}),n(null,{results:O})}function k(){++f===o&&m()}function U(O,x,j){v[O]={id:x,docs:j},k()}var d=[];i.forEach(function(O,x){d.push(x)});var E=0;function P(){if(!(E>=d.length)){var O=Math.min(E+de,d.length),x=d.slice(E,O);g(x,E),E+=x.length}}function g(O,x){O.forEach(function(j,M){var I=x+M,G=i.get(j),W=y(G[0],["atts_since","attachments"]);W.open_revs=G.map(function(Z){return Z.rev}),W.open_revs=W.open_revs.filter(pe);var re=pe;W.open_revs.length===0&&(delete W.open_revs,re=Ce),["revs","attachments","binary","ajax","latest"].forEach(function(Z){Z in t&&(W[Z]=t[Z])}),e.get(j,W,function(Z,fe){var me;Z?me=[{error:Z}]:me=re(fe),U(I,j,me),P()})})}P()}var X;try{localStorage.setItem("_pouch_check_localstorage",1),X=!!localStorage.getItem("_pouch_check_localstorage")}catch{X=!1}function Y(){return X}Q(ce,K);function ae(e){Y()&&addEventListener("storage",function(t){e.emit(t.key)})}function ce(){K.call(this),this._listeners={},ae(this)}ce.prototype.addListener=function(e,t,n,r){if(this._listeners[t])return;var i=this,o=!1;function f(){if(!i._listeners[t])return;if(o){o="waiting";return}o=!0;var v=y(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function m(){o=!1}n.changes(v).on("change",function(k){k.seq>r.since&&!r.cancelled&&(r.since=k.seq,r.onChange(k))}).on("complete",function(){o==="waiting"&&A(f),o=!1}).on("error",m)}this._listeners[t]=f,this.on(e,f)},ce.prototype.removeListener=function(e,t){t in this._listeners&&(K.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},ce.prototype.notifyLocalWindows=function(e){Y()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")},ce.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};function ge(e){if(typeof console<"u"&&typeof console[e]=="function")var t=Array.prototype.slice.call(arguments,1)}function ye(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function Ie(e){var t=0;return e||(t=2e3),ye(e,t)}function tt(e,t){ge("info","The above "+e+" is totally normal. "+t)}Q(ke,Error);function ke(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}ke.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new ke(401,"unauthorized","Name or password is incorrect.");var dt=new ke(400,"bad_request","Missing JSON list of 'docs'"),rt=new ke(404,"not_found","missing"),Ot=new ke(409,"conflict","Document update conflict"),Hn=new ke(400,"bad_request","_id field must contain a string"),Yr=new ke(412,"missing_id","_id is required for puts"),Zr=new ke(400,"bad_request","Only reserved document ids may start with underscore.");new ke(412,"precondition_failed","Database not open");var zn=new ke(500,"unknown_error","Database encountered an unknown error"),Kn=new ke(500,"badarg","Some query argument is invalid");new ke(400,"invalid_request","Request was invalid");var Vr=new ke(400,"query_parse_error","Some query parameter is invalid"),Gn=new ke(500,"doc_validation","Bad special document member"),Nt=new ke(400,"bad_request","Something wrong with the request"),Vt=new ke(400,"bad_request","Document must be a JSON object");new ke(404,"not_found","Database not found");var en=new ke(500,"indexed_db_went_bad","unknown");new ke(500,"web_sql_went_bad","unknown"),new ke(500,"levelDB_went_went_bad","unknown"),new ke(403,"forbidden","Forbidden by design doc validate_doc_update function");var Jn=new ke(400,"bad_request","Invalid rev format");new ke(412,"file_exists","The database could not be created, the file already exists.");var ei=new ke(412,"missing_stub","A pre-existing attachment stub wasn't found");new ke(413,"invalid_url","Provided URL is invalid");function Ee(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),o=0,f=i.length;o<f;o++)typeof e[i[o]]!="function"&&(this[i[o]]=e[i[o]]);r!==void 0&&(this.reason=r)}return n.prototype=ke.prototype,new n(t)}function Tt(e){if(typeof e!="object"){var t=e;e=zn,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function ti(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return Ee(Nt,r)}}function tn(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var o=n&&ti(e.filter,i.doc,t);if(typeof o=="object")return o;if(o)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var f in i.doc._attachments)i.doc._attachments.hasOwnProperty(f)&&(i.doc._attachments[f].stub=!0);return!0}}function $t(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function Wn(e){var t;if(e?typeof e!="string"?t=Ee(Hn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=Ee(Zr)):t=Ee(Yr),t)throw t}function st(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(ge("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function ni(e,t){return"listenerCount"in e?e.listenerCount(t):K.listenerCount(e,t)}function nn(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function Qn(e){var t=nn(e);return t?t.join("/"):null}var Xn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Yn="queryKey",ri=/(?:^|&)([^&=]*)=?([^&]*)/g,ii=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Zn(e){for(var t=ii.exec(e),n={},r=14;r--;){var i=Xn[r],o=t[r]||"",f=["user","password"].indexOf(i)!==-1;n[i]=f?decodeURIComponent(o):o}return n[Yn]={},n[Xn[12]].replace(ri,function(v,m,k){m&&(n[Yn][m]=k)}),n}function rn(e,t){var n=[],r=[];for(var i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function Mt(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,o=n(r);return o?(o._id=t,o._rev=i,ai(e,o,n)):{updated:!1,rev:i}})}function ai(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return Mt(e,t._id,n)})}var an=function(e){return atob(e)},Lt=function(e){return btoa(e)};function on(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if(o.name!=="TypeError")throw o;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function oi(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function un(e,t){return on([oi(e)],{type:t})}function sn(e,t){return un(an(e),t)}function ui(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Vn(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var o=i.target.result||"";if(r)return t(o);t(ui(o))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function er(e,t){Vn(e,function(n){t(n)})}function fn(e,t){er(e,function(n){t(Lt(n))})}function si(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var fi=self.setImmediate||self.setTimeout,ci=32768;function li(e){return Lt(e)}function di(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function hi(e,t,n,r,i){(n>0||r<t.size)&&(t=di(t,n,r)),si(t,function(o){e.append(o),i()})}function vi(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function cn(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(ci,r),o=Math.ceil(r/i),f=0,v=n?new D:new D.ArrayBuffer,m=n?vi:hi;function k(){fi(d)}function U(){var E=v.end(!0),P=li(E);t(P),v.destroy()}function d(){var E=f*i,P=E+i;f++,f<o?m(v,e,E,P,k):m(v,e,E,P,U)}d()}function ln(e){return D.hash(e)}function tr(e,t){if(!t)return N.v4().replace(/-/g,"").toLowerCase();var n=Object.assign({},e);return delete n._rev_tree,ln(JSON.stringify(n))}var Ft=N.v4;function gt(e){for(var t,n,r,i=e.rev_tree.slice(),o;o=i.pop();){var f=o.ids,v=f[2],m=o.pos;if(v.length){for(var k=0,U=v.length;k<U;k++)i.push({pos:m+1,ids:v[k]});continue}var d=!!f[1].deleted,E=f[0];(!t||(r!==d?r:n!==m?n<m:t<E))&&(t=E,n=m,r=d)}return n+"-"+t}function mt(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,o=r.ids,f=o[2],v=t(f.length===0,i,o[0],r.ctx,o[1]),m=0,k=f.length;m<k;m++)n.push({pos:i+1,ids:f[m],ctx:v})}function gi(e,t){return e.pos-t.pos}function dn(e){var t=[];mt(e,function(i,o,f,v,m){i&&t.push({rev:o+"-"+f,pos:o,opts:m})}),t.sort(gi).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function hn(e){for(var t=gt(e),n=dn(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var f=n[i];f.rev!==t&&!f.opts.deleted&&r.push(f.rev)}return r}function mi(e){var t=[];return mt(e.rev_tree,function(n,r,i,o,f){f.status==="available"&&!n&&(t.push(r+"-"+i),f.status="missing")}),t}function nr(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,o=r.ids,f=o[0],v=o[1],m=o[2],k=m.length===0,U=r.history?r.history.slice():[];U.push({id:f,opts:v}),k&&t.push({pos:i+1-U.length,ids:U});for(var d=0,E=m.length;d<E;d++)n.push({pos:i+1,ids:m[d],history:U})}return t.reverse()}function pi(e,t){return e.pos-t.pos}function yi(e,t,n){for(var r=0,i=e.length,o;r<i;)o=r+i>>>1,n(e[o],t)<0?r=o+1:i=o;return r}function _i(e,t,n){var r=yi(e,t,n);e.splice(r,0,t)}function rr(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var f=e[i],v=[f.id,f.opts,[]];r?(r[2].push(v),r=v):n=r=v}return n}function wi(e,t){return e[0]<t[0]?-1:1}function ir(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,f=i.tree2;(o[1].status||f[1].status)&&(o[1].status=o[1].status==="available"||f[1].status==="available"?"available":"missing");for(var v=0;v<f[2].length;v++){if(!o[2][0]){r="new_leaf",o[2][0]=f[2][v];continue}for(var m=!1,k=0;k<o[2].length;k++)o[2][k][0]===f[2][v][0]&&(n.push({tree1:o[2][k],tree2:f[2][v]}),m=!0);m||(r="new_branch",_i(o[2],f[2][v],wi))}}return{conflicts:r,tree:e}}function ar(e,t,n){var r=[],i=!1,o=!1,f;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var v=0,m=e.length;v<m;v++){var k=e[v];if(k.pos===t.pos&&k.ids[0]===t.ids[0])f=ir(k.ids,t.ids),r.push({pos:k.pos,ids:f.tree}),i=i||f.conflicts,o=!0;else if(n!==!0){var U=k.pos<t.pos?k:t,d=k.pos<t.pos?t:k,E=d.pos-U.pos,P=[],g=[];for(g.push({ids:U.ids,diff:E,parent:null,parentIdx:null});g.length>0;){var O=g.pop();if(O.diff===0){O.ids[0]===d.ids[0]&&P.push(O);continue}for(var x=O.ids[2],j=0,M=x.length;j<M;j++)g.push({ids:x[j],diff:O.diff-1,parent:O.ids,parentIdx:j})}var I=P[0];I?(f=ir(I.ids,d.ids),I.parent[2][I.parentIdx]=f.tree,r.push({pos:U.pos,ids:U.ids}),i=i||f.conflicts,o=!0):r.push(k)}else r.push(k)}return o||r.push(t),r.sort(pi),{tree:r,conflicts:i||"internal_node"}}function bi(e,t){for(var n=nr(e),r,i,o=0,f=n.length;o<f;o++){var v=n[o],m=v.ids,k;if(m.length>t){r||(r={});var U=m.length-t;k={pos:v.pos+U,ids:rr(m,U)};for(var d=0;d<U;d++){var E=v.pos+d+"-"+m[d].id;r[E]=!0}}else k={pos:v.pos,ids:rr(m,0)};i?i=ar(i,k,!0).tree:i=[k]}return r&&mt(i,function(P,g,O){delete r[g+"-"+O]}),{tree:i,revs:r?Object.keys(r):[]}}function or(e,t,n){var r=ar(e,t),i=bi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ai(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),o=r[1],f;f=n.pop();){if(f.pos===i&&f.ids[0]===o)return!0;for(var v=f.ids[2],m=0,k=v.length;m<k;m++)n.push({pos:f.pos+1,ids:v[m]})}return!1}function Si(e){return e.ids}function ht(e,t){t||(t=gt(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(Si),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function pt(e){return/^_local/.test(e)}function Oi(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,o=r.ids,f=o[0],v=o[1],m=o[2],k=m.length===0,U=r.history?r.history.slice():[];if(U.push({id:f,pos:i,opts:v}),k)for(var d=0,E=U.length;d<E;d++){var P=U[d],g=P.pos+"-"+P.id;if(g===e)return i+"-"+f}for(var O=0,x=m.length;O<x;O++)n.push({pos:i+1,ids:m[O],history:U})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}Q(Rt,K);function Ti(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){ge("error",'Error in .on("change", function):',i)}}function Rt(e,t,n){K.call(this);var r=this;this.db=e,t=t?s(t):{};var i=t.complete=c(function(v,m){v?ni(r,"error")>0&&r.emit("error",v):r.emit("complete",m),r.removeAllListeners(),e.removeListener("destroyed",o)});n&&(r.on("complete",function(v){n(null,v)}),r.on("error",n));function o(){r.cancel()}e.once("destroyed",o),t.onChange=function(v,m,k){r.isCancelled||Ti(r,v,m,k)};var f=new Promise(function(v,m){t.complete=function(k,U){k?m(k):v(U)}});r.once("cancel",function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})}),this.then=f.then.bind(f),this.catch=f.catch.bind(f),this.then(function(v){i(null,v)},i),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(v){v?t.complete(v):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}Rt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")};function Ci(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=dn(t.rev_tree).map(function(o){return{rev:o.rev}}));var i={id:t.id,changes:r,doc:e};return ht(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=hn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}Rt.prototype.validateChanges=function(e){var t=e.complete,n=this;Te._changesFilterPlugin?Te._changesFilterPlugin.validate(e,function(r){if(r)return t(r);n.doChanges(e)}):n.doChanges(e)},Rt.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=s(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Ci,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(function(o){if(t.isCancelled){n(null,{status:"cancelled"});return}e.since=o.update_seq,t.doChanges(e)},n);return}if(Te._changesFilterPlugin){if(Te._changesFilterPlugin.normalize(e),Te._changesFilterPlugin.shouldFilter(this,e))return Te._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(o){o in e&&ge("warn",'The "'+o+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){var i=t.cancel;t.cancel=B(function(o){r.cancel(),i.apply(this,o)})}};function ur(e,t){return e<t?-1:e>t?1:0}function vn(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function Ei(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=y(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}function Di(e,t){var n=ur(e._id,t._id);if(n!==0)return n;var r=e._revisions?e._revisions.start:0,i=t._revisions?t._revisions.start:0;return ur(r,i)}function Pi(e){var t={},n=[];return mt(e,function(r,i,o,f){var v=i+"-"+o;return r&&(t[v]=0),f!==void 0&&n.push({from:f,to:v}),v}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function qi(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function sr(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(o,f){o?r(o):r(null,f),A(function(){e._compactionQueue.shift(),e._compactionQueue.length&&sr(e)})})})}function Li(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}Q(je,K);function je(){K.call(this);for(var e in je.prototype)typeof this[e]=="function"&&(this[e]=this[e].bind(this))}je.prototype.post=l("post",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="object"||Array.isArray(e))return n(Ee(Vt));this.bulkDocs({docs:[e]},t,vn(n,e._id))}),je.prototype.put=l("put",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="object"||Array.isArray(e))return n(Ee(Vt));if(Wn(e._id),pt(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r=this;t.force&&e._rev?(i(),o(function(f){var v=f?null:{ok:!0,id:e._id,rev:e._rev};n(f,v)})):o(n);function i(){var f=e._rev.split("-"),v=f[1],m=parseInt(f[0],10),k=m+1,U=tr();e._revisions={start:k,ids:[U,v]},e._rev=k+"-"+U,t.new_edits=!1}function o(f){typeof r._put=="function"&&t.new_edits!==!1?r._put(e,t,f):r.bulkDocs({docs:[e]},t,vn(f,e._id))}}),je.prototype.putAttachment=l("putAttachment",function(e,t,n,r,i){var o=this;typeof i=="function"&&(i=r,r=n,n=null),typeof i>"u"&&(i=r,r=n,n=null),i||ge("warn","Attachment",t,"on document",e,"is missing content_type");function f(v){var m="_rev"in v?parseInt(v._rev,10):0;return v._attachments=v._attachments||{},v._attachments[t]={content_type:i,data:r,revpos:++m},o.put(v)}return o.get(e).then(function(v){if(v._rev!==n)throw Ee(Ot);return f(v)},function(v){if(v.reason===rt.message)return f({_id:e});throw v})}),je.prototype.removeAttachment=l("removeAttachment",function(e,t,n,r){var i=this;i.get(e,function(o,f){if(o){r(o);return}if(f._rev!==n){r(Ee(Ot));return}if(!f._attachments)return r();delete f._attachments[t],Object.keys(f._attachments).length===0&&delete f._attachments,i.put(f,r)})}),je.prototype.remove=l("remove",function(e,t,n,r){var i;typeof t=="string"?(i={_id:e,_rev:t},typeof n=="function"&&(r=n,n={})):(i=e,typeof t=="function"?(r=t,n={}):(r=n,n=t)),n=n||{},n.was_delete=!0;var o={_id:i._id,_rev:i._rev||n.rev};if(o._deleted=!0,pt(o._id)&&typeof this._removeLocal=="function")return this._removeLocal(i,r);this.bulkDocs({docs:[o]},n,vn(r,o._id))}),je.prototype.revsDiff=l("revsDiff",function(e,t,n){typeof t=="function"&&(n=t,t={});var r=Object.keys(e);if(!r.length)return n(null,{});var i=0,o=new Map;function f(m,k){o.has(m)||o.set(m,{missing:[]}),o.get(m).missing.push(k)}function v(m,k){var U=e[m].slice(0);mt(k,function(d,E,P,g,O){var x=E+"-"+P,j=U.indexOf(x);j!==-1&&(U.splice(j,1),O.status!=="available"&&f(m,x))}),U.forEach(function(d){f(m,d)})}r.map(function(m){this._getRevisionTree(m,function(k,U){if(k&&k.status===404&&k.message==="missing")o.set(m,{missing:e[m]});else{if(k)return n(k);v(m,U)}if(++i===r.length){var d={};return o.forEach(function(E,P){d[P]=E}),n(null,d)}})},this)}),je.prototype.bulkGet=l("bulkGet",function(e,t){J(this,e,t)}),je.prototype.compactDocument=l("compactDocument",function(e,t,n){var r=this;this._getRevisionTree(e,function(i,o){if(i)return n(i);var f=Pi(o),v=[],m=[];Object.keys(f).forEach(function(k){f[k]>t&&v.push(k)}),mt(o,function(k,U,d,E,P){var g=U+"-"+d;P.status==="available"&&v.indexOf(g)!==-1&&m.push(g)}),r._doCompaction(e,m,n)})}),je.prototype.compact=l("compact",function(e,t){typeof e=="function"&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),n._compactionQueue.length===1&&sr(n)}),je.prototype._compact=function(e,t){var n=this,r={return_docs:!1,last_seq:e.last_seq||0},i=[];function o(v){i.push(n.compactDocument(v.id,0))}function f(v){var m=v.last_seq;Promise.all(i).then(function(){return Mt(n,"_local/compaction",function(U){return!U.last_seq||U.last_seq<m?(U.last_seq=m,U):!1})}).then(function(){t(null,{ok:!0})}).catch(t)}n.changes(r).on("change",o).on("complete",f).on("error",t)},je.prototype.get=l("get",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="string")return n(Ee(Hn));if(pt(e)&&typeof this._getLocal=="function")return this._getLocal(e,n);var r=[],i=this;function o(){var m=[],k=r.length;if(!k)return n(null,m);r.forEach(function(U){i.get(e,{rev:U,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(d,E){if(d)m.push({missing:U});else{for(var P,g=0,O=m.length;g<O;g++)if(m[g].ok&&m[g].ok._rev===E._rev){P=!0;break}P||m.push({ok:E})}k--,k||n(null,m)})})}if(t.open_revs){if(t.open_revs==="all")this._getRevisionTree(e,function(m,k){if(m)return n(m);r=dn(k).map(function(U){return U.rev}),o()});else if(Array.isArray(t.open_revs)){r=t.open_revs;for(var f=0;f<r.length;f++){var v=r[f];if(!(typeof v=="string"&&/^\d+-/.test(v)))return n(Ee(Jn))}o()}else return n(Ee(zn,"function_clause"));return}return this._get(e,t,function(m,k){if(m)return m.docId=e,n(m);var U=k.doc,d=k.metadata,E=k.ctx;if(t.conflicts){var P=hn(d);P.length&&(U._conflicts=P)}if(ht(d,U._rev)&&(U._deleted=!0),t.revs||t.revs_info){for(var g=U._rev.split("-"),O=parseInt(g[0],10),x=g[1],j=nr(d.rev_tree),M=null,I=0;I<j.length;I++){var G=j[I],W=G.ids.map(function(Pe){return Pe.id}).indexOf(x),re=W===O-1;(re||!M&&W!==-1)&&(M=G)}if(!M)return m=new Error("invalid rev tree"),m.docId=e,n(m);var Z=M.ids.map(function(Pe){return Pe.id}).indexOf(U._rev.split("-")[1])+1,fe=M.ids.length-Z;if(M.ids.splice(Z,fe),M.ids.reverse(),t.revs&&(U._revisions={start:M.pos+M.ids.length-1,ids:M.ids.map(function(Pe){return Pe.id})}),t.revs_info){var me=M.pos+M.ids.length;U._revs_info=M.ids.map(function(Pe){return me--,{rev:me+"-"+Pe.id,status:Pe.opts.status}})}}if(t.attachments&&U._attachments){var ue=U._attachments,_e=Object.keys(ue).length;if(_e===0)return n(null,U);Object.keys(ue).forEach(function(Pe){this._getAttachment(U._id,Pe,ue[Pe],{rev:U._rev,binary:t.binary,ctx:E},function(we,Se){var be=U._attachments[Pe];be.data=Se,delete be.stub,delete be.length,--_e||n(null,U)})},i)}else{if(U._attachments)for(var De in U._attachments)U._attachments.hasOwnProperty(De)&&(U._attachments[De].stub=!0);n(null,U)}})}),je.prototype.getAttachment=l("getAttachment",function(e,t,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(e,n,function(o,f){if(o)return r(o);if(f.doc._attachments&&f.doc._attachments[t])n.ctx=f.ctx,n.hasOwnProperty("binary")||(n.binary=!0),i._getAttachment(e,t,f.doc._attachments[t],n,r);else return r(Ee(rt))})}),je.prototype.allDocs=l("allDocs",function(e,t){if(typeof e=="function"&&(t=e,e={}),e.skip=typeof e.skip<"u"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(r){return r in e})[0];if(n){t(Ee(Vr,"Query parameter `"+n+"` is not compatible with multi-get"));return}if(!st(this)&&(qi(e),e.keys.length===0))return this._allDocs({limit:0},t)}return this._allDocs(e,t)}),je.prototype.changes=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new Rt(this,e,t)},je.prototype.close=l("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),je.prototype.info=l("info",function(e){var t=this;this._info(function(n,r){if(n)return e(n);r.db_name=r.db_name||t.name,r.auto_compaction=!!(t.auto_compaction&&!st(t)),r.adapter=t.adapter,e(null,r)})}),je.prototype.id=l("id",function(e){return this._id(e)}),je.prototype.type=function(){return typeof this._type=="function"?this._type():this.adapter},je.prototype.bulkDocs=l("bulkDocs",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(Ee(dt));for(var r=0;r<e.docs.length;++r)if(typeof e.docs[r]!="object"||Array.isArray(e.docs[r]))return n(Ee(Vt));var i;if(e.docs.forEach(function(v){v._attachments&&Object.keys(v._attachments).forEach(function(m){i=i||Li(m),v._attachments[m].content_type||ge("warn","Attachment",m,"on document",v._id,"is missing content_type")})}),i)return n(Ee(Nt,i));"new_edits"in t||("new_edits"in e?t.new_edits=e.new_edits:t.new_edits=!0);var o=this;!t.new_edits&&!st(o)&&e.docs.sort(Di),Ei(e.docs);var f=e.docs.map(function(v){return v._id});return this._bulkDocs(e,t,function(v,m){if(v)return n(v);if(t.new_edits||(m=m.filter(function(d){return d.error})),!st(o))for(var k=0,U=m.length;k<U;k++)m[k].id=m[k].id||f[k];n(null,m)})}),je.prototype.registerDependentDatabase=l("registerDependentDatabase",function(e,t){var n=new this.constructor(e,this.__opts);function r(i){return i.dependentDbs=i.dependentDbs||{},i.dependentDbs[e]?!1:(i.dependentDbs[e]=!0,i)}Mt(this,"_local/_pouch_dependentDbs",r).then(function(){t(null,{db:n})}).catch(t)}),je.prototype.destroy=l("destroy",function(e,t){typeof e=="function"&&(t=e,e={});var n=this,r="use_prefix"in n?n.use_prefix:!0;function i(){n._destroy(e,function(o,f){if(o)return t(o);n._destroyed=!0,n.emit("destroyed"),t(null,f||{ok:!0})})}if(st(n))return i();n.get("_local/_pouch_dependentDbs",function(o,f){if(o)return o.status!==404?t(o):i();var v=f.dependentDbs,m=n.constructor,k=Object.keys(v).map(function(U){var d=r?U.replace(new RegExp("^"+m.prefix),""):U;return new m(d,n.__opts).destroy()});Promise.all(k).then(i,t)})});function kt(){this.isReady=!1,this.failed=!1,this.queue=[]}kt.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},kt.prototype.fail=function(e){this.failed=e,this.execute()},kt.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},kt.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()};function Ri(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Te.adapters,i=Te.preferredAdapters,o=Te.prefix,f=t.adapter;if(!f)for(var v=0;v<i.length;++v){if(f=i[v],f==="idb"&&"websql"in r&&Y()&&localStorage["_pouch__websqldb_"+o+e]){ge("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var m=r[f],k=m&&"use_prefix"in m?m.use_prefix:!0;return{name:k?o+e:e,adapter:f}}function ki(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}Q(Te,je);function Te(e,t){if(!(this instanceof Te))return new Te(e,t);var n=this;if(t=t||{},e&&typeof e=="object"&&(t=e,e=t.name,delete t.name),t.deterministic_revs===void 0&&(t.deterministic_revs=!0),this.__opts=t=s(t),n.auto_compaction=t.auto_compaction,n.prefix=Te.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(t.prefix||"")+e,i=Ri(r,t);if(t.name=i.name,t.adapter=t.adapter||i.adapter,n.name=e,n._adapter=t.adapter,Te.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Te.adapters[t.adapter]||!Te.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);je.call(n),n.taskqueue=new kt,n.adapter=t.adapter,Te.adapters[t.adapter].call(n,t,function(o){if(o)return n.taskqueue.fail(o);ki(n),n.emit("created",n),Te.emit("created",n.name),n.taskqueue.ready(n)})}var Bi=typeof AbortController<"u"?AbortController:function(){return{abort:function(){}}},fr=fetch,Ct=Headers;Te.adapters={},Te.preferredAdapters=[],Te.prefix="_pouch_";var cr=new K;function Ii(e){Object.keys(K.prototype).forEach(function(n){typeof K.prototype[n]=="function"&&(e[n]=cr[n].bind(cr))});var t=e._destructionListeners=new Map;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),o=i.indexOf(r);o<0||(i.splice(o,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(o){o.emit("destroyed",!0)})}})}Ii(Te),Te.adapter=function(e,t,n){t.valid()&&(Te.adapters[e]=t,n&&Te.preferredAdapters.push(e))},Te.plugin=function(e){if(typeof e=="function")e(Te);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){Te.prototype[t]=e[t]})}return this.__defaults&&(Te.__defaults=Object.assign({},this.__defaults)),Te},Te.defaults=function(e){function t(n,r){if(!(this instanceof t))return new t(n,r);r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},t.__defaults,r),Te.call(this,n,r)}return Q(t,Te),t.preferredAdapters=Te.preferredAdapters.slice(),Object.keys(Te).forEach(function(n){n in t||(t[n]=Te[n])}),t.__defaults=Object.assign({},this.__defaults,e),t},Te.fetch=function(e,t){return fr(e,t)};var xi="7.0.0-prerelease";function gn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var o=t[r];if(n=n[o],!n)break}return n}function ji(e,t){return e<t?-1:e>t?1:0}function mn(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var o=e[r];r>0&&e[r-1]==="\\"&&(o==="$"||o===".")?n=n.substring(0,n.length-1)+o:o==="."?(t.push(n),n=""):n+=o}return t.push(n),t}var Ui=["$or","$nor","$not"];function lr(e){return Ui.indexOf(e)>-1}function dr(e){return Object.keys(e)[0]}function Ni(e){return e[dr(e)]}function Bt(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var o=r[i];if(typeof o!="object"&&(o={$eq:o}),lr(i))if(o instanceof Array){if(n[i]){n[i]=!1,t[i]=o;return}var f=[];t[i].forEach(function(m){Object.keys(o).forEach(function(k){var U=o[k],d=Math.max(Object.keys(m).length,Object.keys(U).length),E=Bt([m,U]);Object.keys(E).length<=d||f.push(E)})}),t[i]=f}else t[i]=Bt([o]);else{var v=t[i]=t[i]||{};Object.keys(o).forEach(function(m){var k=o[m];if(m==="$gt"||m==="$gte")return $i(m,k,v);if(m==="$lt"||m==="$lte")return Mi(m,k,v);if(m==="$ne")return Fi(k,v);if(m==="$eq")return Hi(k,v);if(m==="$regex")return zi(k,v);v[m]=k})}})}),t}function $i(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function Mi(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function Fi(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Hi(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function zi(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function hr(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Bt(e[n].$and));var r=e[t];typeof r=="object"&&hr(r)}return e}function vr(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=vr(r,t))}return t}function Ki(e){var t=s(e),n=!1;vr(t,!1)&&(t=hr(t),"$and"in t&&(t=Bt(t.$and)),n=!0),["$or","$nor"].forEach(function(v){v in t&&t[v].forEach(function(m){for(var k=Object.keys(m),U=0;U<k.length;U++){var d=k[U],E=m[d];(typeof E!="object"||E===null)&&(m[d]={$eq:E})}})}),"$not"in t&&(t.$not=Bt([t.$not]));for(var r=Object.keys(t),i=0;i<r.length;i++){var o=r[i],f=t[o];typeof f!="object"||f===null?f={$eq:f}:n||("$ne"in f&&(f.$ne=[f.$ne]),"$regex"in f&&(f.$regex=[f.$regex])),t[o]=f}return t}function Gi(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Ji(e,t,n){var r=Gi(e,t,n);return r+e}var gr=-324,pn=3,yn="";function He(e,t){if(e===t)return 0;e=yt(e),t=yt(t);var n=_n(e),r=_n(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Zi(e,t)}return Array.isArray(e)?Yi(e,t):Vi(e,t)}function yt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=yt(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];typeof o<"u"&&(e[i]=yt(o))}}}}return e}function Wi(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return ea(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,o="";if(t)for(;++r<i;)o+=it(n[r]);else for(;++r<i;){var f=n[r];o+=it(f)+it(e[f])}return o}return""}function it(e){var t="\0";return e=yt(e),_n(e)+yn+Wi(e)+t}function Qi(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var o=e[t]==="0";t++;var f="",v=e.substring(t,t+pn),m=parseInt(v,10)+gr;for(o&&(m=-m),t+=pn;;){var k=e[t];if(k==="\0")break;f+=k,t++}f=f.split("."),f.length===1?r=parseInt(f,10):r=parseFloat(f[0]+"."+f[1]),o&&(r=r-10),m!==0&&(r=parseFloat(r+"e"+m))}return{num:r,length:t-n}}function Xi(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(n);else if(o===e.length-2){var f=e.pop();i[f]=n}else e.push(n)}}function mr(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Xi(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var o=Qi(e,r);t.push(o.num),r+=o.length;break;case"4":for(var f="";;){var v=e[r];if(v==="\0")break;f+=v,r++}f=f.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(f);break;case"5":var m={element:[],index:t.length};t.push(m.element),n.push(m);break;case"6":var k={element:{},index:t.length};t.push(k.element),n.push(k);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Yi(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=He(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Zi(e,t){return e===t?0:e>t?1:-1}function Vi(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),o=0;o<i;o++){var f=He(n[o],r[o]);if(f!==0||(f=He(e[n[o]],t[r[o]]),f!==0))return f}return n.length===r.length?0:n.length>r.length?1:-1}function _n(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function ea(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",o=(r?-n:n)-gr,f=Ji(o.toString(),"0",pn);i+=yn+f;var v=Math.abs(parseFloat(t[0]));r&&(v=10-v);var m=v.toFixed(20);return m=m.replace(/\.?0+$/,""),i+=yn+m,i}function ta(e){function t(n){return e.map(function(r){var i=dr(r),o=mn(i),f=gn(n,o);return f})}return function(n,r){var i=t(n.doc),o=t(r.doc),f=He(i,o);return f!==0?f:ji(n.doc._id,r.doc._id)}}function na(e,t,n){if(e=e.filter(function(f){return Et(f.doc,t.selector,n)}),t.sort){var r=ta(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&Ni(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function Et(e,t,n){return n.every(function(r){var i=t[r],o=mn(r),f=gn(e,o);return lr(r)?ra(r,i,e):Ht(i,e,o,f)})}function Ht(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var o=e[i];if(i.indexOf("$")===0)return pr(i,t,o,n,r);var f=mn(i);if(r===void 0&&typeof o!="object"&&f.length>0)return!1;var v=gn(r,f);return typeof o=="object"?Ht(o,t,n,v):pr("$eq",t,o,f,v)}):e===r:!0}function ra(e,t,n){return e==="$or"?t.some(function(r){return Et(n,r,Object.keys(r))}):e==="$not"?!Et(n,t,Object.keys(t)):!t.find(function(r){return Et(n,r,Object.keys(r))})}function pr(e,t,n,r,i){if(!_r[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return _r[e](t,n,r,i)}function It(e){return typeof e<"u"&&e!==null}function _t(e){return typeof e<"u"}function ia(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function yr(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return He(n,r)===0}):He(n,e)===0})}function aa(e,t){return t.every(function(n){return e.some(function(r){return He(n,r)===0})})}function oa(e,t){return e.length===t}function ua(e,t){var n=new RegExp(t);return n.test(e)}function sa(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var _r={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"?r.some(function(i){return Et(i,t,Object.keys(t))}):r.some(function(i){return Ht(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"?r.every(function(i){return Et(i,t,Object.keys(t))}):r.every(function(i){return Ht(t,e,n,i)})},$eq:function(e,t,n,r){return _t(r)&&He(r,t)===0},$gte:function(e,t,n,r){return _t(r)&&He(r,t)>=0},$gt:function(e,t,n,r){return _t(r)&&He(r,t)>0},$lte:function(e,t,n,r){return _t(r)&&He(r,t)<=0},$lt:function(e,t,n,r){return _t(r)&&He(r,t)<0},$exists:function(e,t,n,r){return t?_t(r):!_t(r)},$mod:function(e,t,n,r){return It(r)&&ia(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return He(r,i)!==0})},$in:function(e,t,n,r){return It(r)&&yr(r,t)},$nin:function(e,t,n,r){return It(r)&&!yr(r,t)},$size:function(e,t,n,r){return It(r)&&Array.isArray(r)&&oa(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&aa(r,t)},$regex:function(e,t,n,r){return It(r)&&typeof r=="string"&&t.every(function(i){return ua(r,i)})},$type:function(e,t,n,r){return sa(r,t)}};function fa(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=Ki(t);var n={doc:e},r=na([n],{selector:t},Object.keys(t));return r&&r.length===1}function ca(e){return rn(`"use strict";
return `+e+";",{})}function la(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return rn(t,{})}function da(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function ha(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=Qn(e.view):e.filter=Qn(e.filter))}function va(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!st(e.db)}function ga(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=Ee(Nt,"`view` filter parameter not found or invalid.");return n(r)}var i=nn(t.view);e.db.get("_design/"+i[0],function(f,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(f)return n(Tt(f));var m=v&&v.views&&v.views[i[1]]&&v.views[i[1]].map;if(!m)return n(Ee(rt,v.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=la(m),e.doChanges(t)})}else if(t.selector)t.filter=function(f){return fa(f,t.selector)},e.doChanges(t);else{var o=nn(t.filter);e.db.get("_design/"+o[0],function(f,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(f)return n(Tt(f));var m=v&&v.filters&&v.filters[o[1]];if(!m)return n(Ee(rt,v&&v.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=ca(m),e.doChanges(t)})}}function ma(e){e._changesFilterPlugin={validate:da,normalize:ha,shouldFilter:va,filter:ga}}Te.plugin(ma),Te.version=xi;function wr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var pa=wr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ya=wr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function br(e){if(!/^\d+-/.test(e))return Ee(Jn);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function _a(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,f=r.length;o<f;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Ar(e,t,n){n||(n={deterministic_revs:!0});var r,i,o,f={status:"available"};if(e._deleted&&(f.deleted=!0),t)if(e._id||(e._id=Ft()),i=tr(e,n.deterministic_revs),e._rev){if(o=br(e._rev),o.error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,f,[]]]]}],r=o.prefix+1}else e._rev_tree=[{pos:1,ids:[i,f,[]]}],r=1;else if(e._revisions&&(e._rev_tree=_a(e._revisions,f),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(o=br(e._rev),o.error)return o;r=o.prefix,i=o.id,e._rev_tree=[{pos:r,ids:[i,f,[]]}]}Wn(e._id),e._rev=r+"-"+i;var v={metadata:{},data:{}};for(var m in e)if(Object.prototype.hasOwnProperty.call(e,m)){var k=m[0]==="_";if(k&&!pa[m]){var U=Ee(Gn,m);throw U.message=Gn.message+": "+m,U}else k&&!ya[m]?v.metadata[m.slice(1)]=e[m]:v.data[m]=e[m]}return v}function wa(e){try{return an(e)}catch{var t=Ee(Kn,"Attachment is not a valid base64 string");return{error:t}}}function ba(e,t,n){var r=wa(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=un(r,e.content_type):t==="base64"?e.data=Lt(r):e.data=r,cn(r,function(i){e.digest="md5-"+i,n()})}function Aa(e,t,n){cn(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?er(e.data,function(i){e.data=i,n()}):t==="base64"?fn(e.data,function(i){e.data=i,n()}):n()})}function Sa(e,t,n){if(e.stub)return n();typeof e.data=="string"?ba(e,t,n):Aa(e,t,n)}function Oa(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(f){var v=f.data&&f.data._attachments?Object.keys(f.data._attachments):[],m=0;if(!v.length)return o();function k(d){i=d,m++,m===v.length&&o()}for(var U in f.data._attachments)f.data._attachments.hasOwnProperty(U)&&Sa(f.data._attachments[U],t,k)});function o(){r++,e.length===r&&(i?n(i):n())}}function Ta(e,t,n,r,i,o,f,v){if(Ai(t.rev_tree,n.metadata.rev)&&!v)return r[i]=n,o();var m=t.winningRev||gt(t),k="deleted"in t?t.deleted:ht(t,m),U="deleted"in n.metadata?n.metadata.deleted:ht(n.metadata),d=/^1-/.test(n.metadata.rev);if(k&&!U&&v&&d){var E=n.data;E._rev=m,E._id=n.metadata.id,n=Ar(E,v)}var P=or(t.rev_tree,n.metadata.rev_tree[0],e),g=v&&(k&&U&&P.conflicts!=="new_leaf"||!k&&P.conflicts!=="new_leaf"||k&&!U&&P.conflicts==="new_branch");if(g){var O=Ee(Ot);return r[i]=O,o()}var x=n.metadata.rev;n.metadata.rev_tree=P.tree,n.stemmedRevs=P.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var j=gt(n.metadata),M=ht(n.metadata,j),I=k===M?0:k<M?-1:1,G;x===j?G=M:G=ht(n.metadata,x),f(n,j,M,G,!0,I,i,o)}function Ca(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function Ea(e,t,n,r,i,o,f,v,m){e=e||1e3;function k(O,x,j){var M=gt(O.metadata),I=ht(O.metadata,M);if("was_delete"in v&&I)return o[x]=Ee(rt,"deleted"),j();var G=U&&Ca(O);if(G){var W=Ee(Ot);return o[x]=W,j()}var re=I?0:1;f(O,M,I,I,!1,re,x,j)}var U=v.new_edits,d=new Map,E=0,P=t.length;function g(){++E===P&&m&&m()}t.forEach(function(O,x){if(O._id&&pt(O._id)){var j=O._deleted?"_removeLocal":"_putLocal";n[j](O,{ctx:i},function(I,G){o[x]=I||G,g()});return}var M=O.metadata.id;d.has(M)?(P--,d.get(M).push([O,x])):d.set(M,[[O,x]])}),d.forEach(function(O,x){var j=0;function M(){++j<O.length?I():g()}function I(){var G=O[j],W=G[0],re=G[1];if(r.has(x))Ta(e,r.get(x),W,o,re,M,f,U);else{var Z=or([],W.metadata.rev_tree[0],e);W.metadata.rev_tree=Z.tree,W.stemmedRevs=Z.stemmedRevs||[],k(W,re,M)}}I()})}var Da=5,Ge="document-store",Ye="by-sequence",at="attach-store",wt="attach-seq-store",Ve="meta-store",ft="local-store",wn="detect-blob-support";function Pa(e){try{return JSON.parse(e)}catch{return L.parse(e)}}function qa(e){try{return JSON.stringify(e)}catch{return L.stringify(e)}}function ct(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(Ee(en,n,t.type))}}function bn(e,t,n){return{data:qa(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function bt(e){if(!e)return null;var t=Pa(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function zt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Sr(e,t,n,r){n?r(e?typeof e!="string"?e:sn(e,t):on([""],{type:t})):e?typeof e!="string"?Vn(e,function(i){r(Lt(i))}):r(e):r("")}function Or(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var o=0;function f(){++o===i.length&&r&&r()}function v(m,k){var U=m._attachments[k],d=U.digest,E=n.objectStore(at).get(d);E.onsuccess=function(P){U.body=P.target.result.body,f()}}i.forEach(function(m){t.attachments&&t.include_docs?v(e,m):(e._attachments[m].stub=!0,f())})}function An(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var o=n.doc._attachments[i];if("body"in o){var f=o.body,v=o.content_type;return new Promise(function(m){Sr(f,v,t,function(k){n.doc._attachments[i]=Object.assign(y(o,["digest","content_type"]),{data:k}),m()})})}}))}}))}function Tr(e,t,n){var r=[],i=n.objectStore(Ye),o=n.objectStore(at),f=n.objectStore(wt),v=e.length;function m(){v--,v||k()}function k(){r.length&&r.forEach(function(U){var d=f.index("digestSeq").count(IDBKeyRange.bound(U+"::",U+"::￿",!1,!1));d.onsuccess=function(E){var P=E.target.result;P||o.delete(U)}})}e.forEach(function(U){var d=i.index("_doc_id_rev"),E=t+"::"+U;d.getKey(E).onsuccess=function(P){var g=P.target.result;if(typeof g!="number")return m();i.delete(g);var O=f.index("seq").openCursor(IDBKeyRange.only(g));O.onsuccess=function(x){var j=x.target.result;if(j){var M=j.value.digestSeq.split("::")[0];r.push(M),f.delete(j.primaryKey),j.continue()}else m()}}})}function ut(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var xt=new ce;function La(e,t,n,r,i,o){for(var f=t.docs,v,m,k,U,d,E,P,g,O=0,x=f.length;O<x;O++){var j=f[O];j._id&&pt(j._id)||(j=f[O]=Ar(j,n.new_edits,e),j.error&&!P&&(P=j))}if(P)return o(P);var M=!1,I=0,G=new Array(f.length),W=new Map,re=!1,Z=r._meta.blobSupport?"blob":"base64";Oa(f,Z,function(C){if(C)return o(C);fe()});function fe(){var C=[Ge,Ye,at,ft,wt,Ve],R=ut(i,C,"readwrite");if(R.error)return o(R.error);v=R.txn,v.onabort=ct(o),v.ontimeout=ct(o),v.oncomplete=Pe,m=v.objectStore(Ge),k=v.objectStore(Ye),U=v.objectStore(at),d=v.objectStore(wt),E=v.objectStore(Ve),E.get(Ve).onsuccess=function(T){g=T.target.result,_e()},Se(function(T){if(T)return re=!0,o(T);De()})}function me(){M=!0,_e()}function ue(){Ea(e.revs_limit,f,r,W,v,G,be,n,me)}function _e(){!g||!M||(g.docCount+=I,g.docCount<0&&(g.docCount=0),E.put(g))}function De(){if(!f.length)return;var C=0;function R(){++C===f.length&&ue()}function T(te){var se=bt(te.target.result);se&&W.set(se.id,se),R()}for(var F=0,V=f.length;F<V;F++){var ne=f[F];if(ne._id&&pt(ne._id)){R();continue}var ie=m.get(ne.metadata.id);ie.onsuccess=T}}function Pe(){re||(xt.notify(r._meta.name),o(null,G))}function we(C,R){var T=U.get(C);T.onsuccess=function(F){if(F.target.result)R();else{var V=Ee(ei,"unknown stub attachment with digest "+C);V.status=412,R(V)}}}function Se(C){var R=[];if(f.forEach(function(ne){ne.data&&ne.data._attachments&&Object.keys(ne.data._attachments).forEach(function(ie){var te=ne.data._attachments[ie];te.stub&&R.push(te.digest)})}),!R.length)return C();var T=0,F;function V(){++T===R.length&&C(F)}R.forEach(function(ne){we(ne,function(ie){ie&&!F&&(F=ie),V()})})}function be(C,R,T,F,V,ne,ie,te){C.metadata.winningRev=R,C.metadata.deleted=T;var se=C.data;se._id=C.metadata.id,se._rev=C.metadata.rev,F&&(se._deleted=!0),I+=ne,_e();var ve=se._attachments&&Object.keys(se._attachments).length;if(ve)return Ue(C,R,T,V,ie,te);Re(C,R,T,V,ie,te)}function Re(C,R,T,F,V,ne){var ie=C.data,te=C.metadata;ie._doc_id_rev=te.id+"::"+te.rev,delete ie._id,delete ie._rev;function se(Oe){var xe=C.stemmedRevs||[];F&&r.auto_compaction&&(xe=xe.concat(mi(C.metadata))),xe&&xe.length&&Tr(xe,C.metadata.id,v),te.seq=Oe.target.result;var We=bn(te,R,T),Ne=m.put(We);Ne.onsuccess=Le}function ve(Oe){Oe.preventDefault(),Oe.stopPropagation();var xe=k.index("_doc_id_rev"),We=xe.getKey(ie._doc_id_rev);We.onsuccess=function(Ne){var Qe=k.put(ie,Ne.target.result);Qe.onsuccess=se}}function Le(){G[V]={ok:!0,id:te.id,rev:te.rev},W.set(C.metadata.id,C.metadata),ze(C,te.seq,ne)}var le=k.put(ie);le.onsuccess=se,le.onerror=ve}function Ue(C,R,T,F,V,ne){var ie=C.data,te=0,se=Object.keys(ie._attachments);function ve(){te===se.length&&Re(C,R,T,F,V,ne)}function Le(){te++,ve()}se.forEach(function(le){var Oe=C.data._attachments[le];if(Oe.stub)te++,ve();else{var xe=Oe.data;delete Oe.data,Oe.revpos=parseInt(R,10);var We=Oe.digest;Ze(We,xe,Le)}})}function ze(C,R,T){var F=0,V=Object.keys(C.data._attachments||{});if(!V.length)return T();function ne(){++F===V.length&&T()}function ie(se){var ve=C.data._attachments[se].digest,Le=d.put({seq:R,digestSeq:ve+"::"+R});Le.onsuccess=ne,Le.onerror=function(le){le.preventDefault(),le.stopPropagation(),ne()}}for(var te=0;te<V.length;te++)ie(V[te])}function Ze(C,R,T){var F=U.count(C);F.onsuccess=function(V){var ne=V.target.result;if(ne)return T();var ie={digest:C,body:R},te=U.put(ie);te.onsuccess=T}}}function Cr(e,t,n,r,i){r===-1&&(r=1e3);var o=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,f,v,m;function k(P){v=P.target.result,f&&i(f,v,m)}function U(P){f=P.target.result,v&&i(f,v,m)}function d(){if(!f.length)return i();var P=f[f.length-1],g;if(t&&t.upper)try{g=IDBKeyRange.bound(P,t.upper,!0,t.upperOpen)}catch(O){if(O.name==="DataError"&&O.code===0)return i()}else g=IDBKeyRange.lowerBound(P,!0);t=g,f=null,v=null,e.getAll(t,r).onsuccess=k,e.getAllKeys(t,r).onsuccess=U}function E(P){var g=P.target.result;if(!g)return i();i([g.key],[g.value],g)}o?(m={continue:d},e.getAll(t,r).onsuccess=k,e.getAllKeys(t,r).onsuccess=U):n?e.openCursor(t,"prev").onsuccess=E:e.openCursor(t).onsuccess=E}function Ra(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(o){var f=o.target.result;f?(r.push(f.value),f.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function ka(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(o,f){t.get(o).onsuccess=function(v){v.target.result?r[f]=v.target.result:r[f]={key:o,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function Ba(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(o){return{error:o}}return null}function Ia(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,o="key"in e?e.key:!1,f="keys"in e?e.keys:!1,v=e.skip||0,m=typeof e.limit=="number"?e.limit:-1,k=e.inclusive_end!==!1,U,d;if(!f&&(U=Ba(r,i,k,o,e.descending),d=U&&U.error,d&&!(d.name==="DataError"&&d.code===0)))return n(Ee(en,d.name,d.message));var E=[Ge,Ye,Ve];e.attachments&&E.push(at);var P=ut(t,E,"readonly");if(P.error)return n(P.error);var g=P.txn;g.oncomplete=Pe,g.onabort=ct(n);var O=g.objectStore(Ge),x=g.objectStore(Ye),j=g.objectStore(Ve),M=x.index("_doc_id_rev"),I=[],G,W;j.get(Ve).onsuccess=function(we){G=we.target.result.docCount},e.update_seq&&re(x,function(we){we.target.result&&we.target.result.length>0&&(W=we.target.result[0])});function re(we,Se){function be(Re){var Ue=Re.target.result,ze=void 0;return Ue&&Ue.key&&(ze=Ue.key),Se({target:{result:[ze]}})}we.openCursor(null,"prev").onsuccess=be}function Z(we,Se,be){var Re=we.id+"::"+be;M.get(Re).onsuccess=function(ze){if(Se.doc=zt(ze.target.result)||{},e.conflicts){var Ze=hn(we);Ze.length&&(Se.doc._conflicts=Ze)}Or(Se.doc,e,g)}}function fe(we,Se){var be={id:Se.id,key:Se.id,value:{rev:we}},Re=Se.deleted;Re?f&&(I.push(be),be.value.deleted=!0,be.doc=null):v--<=0&&(I.push(be),e.include_docs&&Z(Se,be,we))}function me(we){for(var Se=0,be=we.length;Se<be&&I.length!==m;Se++){var Re=we[Se];if(Re.error&&f){I.push(Re);continue}var Ue=bt(Re),ze=Ue.winningRev;fe(ze,Ue)}}function ue(we,Se,be){be&&(me(Se),I.length<m&&be.continue())}function _e(we){var Se=we.target.result;e.descending&&(Se=Se.reverse()),me(Se)}function De(){var we={total_rows:G,offset:e.skip,rows:I};e.update_seq&&W!==void 0&&(we.update_seq=W),n(null,we)}function Pe(){e.attachments?An(I,e.binary).then(De):De()}if(!(d||m===0)){if(f)return ka(e.keys,O,ue);if(m===-1)return Ra(O,U,_e);Cr(O,U,e.descending,m+v,ue)}}function xa(e){return new Promise(function(t){var n=on([""]),r=e.objectStore(wn).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);t(o||!i||parseInt(i[1],10)>=43)},r.onerror=e.onabort=function(i){i.preventDefault(),i.stopPropagation(),t(!1)}}).catch(function(){return!1})}var Sn=!1,On=[];function ja(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function Er(){Sn||!On.length||(Sn=!0,On.shift()())}function Ua(e,t,n){On.push(function(){e(function(o,f){ja(t,o,f,n),Sn=!1,A(function(){Er()})})}),Er()}function Na(e,t,n,r){if(e=s(e),e.continuous){var i=n+":"+Ft();return xt.addListener(n,i,t,e),xt.notify(n),{cancel:function(){xt.removeListener(n,i)}}}var o=e.doc_ids&&new Set(e.doc_ids);e.since=e.since||0;var f=e.since,v="limit"in e?e.limit:-1;v===0&&(v=1);var m=[],k=0,U=tn(e),d=new Map,E,P,g,O;function x(fe,me,ue){if(!ue||!fe.length)return;var _e=new Array(fe.length),De=new Array(fe.length);function Pe(be,Re){var Ue=e.processChange(Re,be,e);f=Ue.seq=be.seq;var ze=U(Ue);return typeof ze=="object"?Promise.reject(ze):ze?(k++,e.return_docs&&m.push(Ue),e.attachments&&e.include_docs?new Promise(function(Ze){Or(Re,e,E,function(){An([Ue],e.binary).then(function(){Ze(Ue)})})}):Promise.resolve(Ue)):Promise.resolve()}function we(){for(var be=[],Re=0,Ue=_e.length;Re<Ue&&k!==v;Re++){var ze=_e[Re];if(ze){var Ze=De[Re];be.push(Pe(Ze,ze))}}Promise.all(be).then(function(C){for(var R=0,T=C.length;R<T;R++)C[R]&&e.onChange(C[R])}).catch(e.complete),k!==v&&ue.continue()}var Se=0;me.forEach(function(be,Re){var Ue=zt(be),ze=fe[Re];M(Ue,ze,function(Ze,C){De[Re]=Ze,_e[Re]=C,++Se===fe.length&&we()})})}function j(fe,me,ue,_e){if(ue.seq!==me)return _e();if(ue.winningRev===fe._rev)return _e(ue,fe);var De=fe._id+"::"+ue.winningRev,Pe=O.get(De);Pe.onsuccess=function(we){_e(ue,zt(we.target.result))}}function M(fe,me,ue){if(o&&!o.has(fe._id))return ue();var _e=d.get(fe._id);if(_e)return j(fe,me,_e,ue);g.get(fe._id).onsuccess=function(De){_e=bt(De.target.result),d.set(fe._id,_e),j(fe,me,_e,ue)}}function I(){e.complete(null,{results:m,last_seq:f})}function G(){!e.continuous&&e.attachments?An(m).then(I):I()}var W=[Ge,Ye];e.attachments&&W.push(at);var re=ut(r,W,"readonly");if(re.error)return e.complete(re.error);E=re.txn,E.onabort=ct(e.complete),E.oncomplete=G,P=E.objectStore(Ye),g=E.objectStore(Ge),O=P.index("_doc_id_rev");var Z=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;Cr(P,Z,e.descending,v,x)}var Dt=new Map,Tn,Cn=new Map;function Dr(e,t){var n=this;Ua(function(r){$a(n,e,r)},t,n.constructor)}function $a(e,t,n){var r=t.name,i=null;e._meta=null;function o(g){var O=g.createObjectStore(Ge,{keyPath:"id"});g.createObjectStore(Ye,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),g.createObjectStore(at,{keyPath:"digest"}),g.createObjectStore(Ve,{keyPath:"id",autoIncrement:!1}),g.createObjectStore(wn),O.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),g.createObjectStore(ft,{keyPath:"_id"});var x=g.createObjectStore(wt,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function f(g,O){var x=g.objectStore(Ge);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(j){var M=j.target.result;if(M){var I=M.value,G=ht(I);I.deletedOrLocal=G?"1":"0",x.put(I),M.continue()}else O()}}function v(g){g.createObjectStore(ft,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function m(g,O){var x=g.objectStore(ft),j=g.objectStore(Ge),M=g.objectStore(Ye),I=j.openCursor();I.onsuccess=function(G){var W=G.target.result;if(W){var re=W.value,Z=re.id,fe=pt(Z),me=gt(re);if(fe){var ue=Z+"::"+me,_e=Z+"::",De=Z+"::~",Pe=M.index("_doc_id_rev"),we=IDBKeyRange.bound(_e,De,!1,!1),Se=Pe.openCursor(we);Se.onsuccess=function(be){if(Se=be.target.result,!Se)j.delete(W.primaryKey),W.continue();else{var Re=Se.value;Re._doc_id_rev===ue&&x.put(Re),M.delete(Se.primaryKey),Se.continue()}}}else W.continue()}else O&&O()}}function k(g){var O=g.createObjectStore(wt,{autoIncrement:!0});O.createIndex("seq","seq"),O.createIndex("digestSeq","digestSeq",{unique:!0})}function U(g,O){var x=g.objectStore(Ye),j=g.objectStore(at),M=g.objectStore(wt),I=j.count();I.onsuccess=function(G){var W=G.target.result;if(!W)return O();x.openCursor().onsuccess=function(re){var Z=re.target.result;if(!Z)return O();for(var fe=Z.value,me=Z.primaryKey,ue=Object.keys(fe._attachments||{}),_e={},De=0;De<ue.length;De++){var Pe=fe._attachments[ue[De]];_e[Pe.digest]=!0}var we=Object.keys(_e);for(De=0;De<we.length;De++){var Se=we[De];M.put({seq:me,digestSeq:Se+"::"+me})}Z.continue()}}}function d(g){function O(I){return I.data?bt(I):(I.deleted=I.deletedOrLocal==="1",I)}var x=g.objectStore(Ye),j=g.objectStore(Ge),M=j.openCursor();M.onsuccess=function(I){var G=I.target.result;if(!G)return;var W=O(G.value);W.winningRev=W.winningRev||gt(W);function re(){var fe=W.id+"::",me=W.id+"::￿",ue=x.index("_doc_id_rev").openCursor(IDBKeyRange.bound(fe,me)),_e=0;ue.onsuccess=function(De){var Pe=De.target.result;if(!Pe)return W.seq=_e,Z();var we=Pe.primaryKey;we>_e&&(_e=we),Pe.continue()}}function Z(){var fe=bn(W,W.winningRev,W.deleted),me=j.put(fe);me.onsuccess=function(){G.continue()}}if(W.seq)return Z();re()}}e._remote=!1,e.type=function(){return"idb"},e._id=a(function(g){g(null,e._meta.instanceId)}),e._bulkDocs=function(O,x,j){La(t,O,x,e,i,j)},e._get=function(O,x,j){var M,I,G,W=x.ctx;if(!W){var re=ut(i,[Ge,Ye,at],"readonly");if(re.error)return j(re.error);W=re.txn}function Z(){j(G,{doc:M,metadata:I,ctx:W})}W.objectStore(Ge).get(O).onsuccess=function(fe){if(I=bt(fe.target.result),!I)return G=Ee(rt,"missing"),Z();var me;if(x.rev)me=x.latest?Oi(x.rev,I):x.rev;else{me=I.winningRev;var ue=ht(I);if(ue)return G=Ee(rt,"deleted"),Z()}var _e=W.objectStore(Ye),De=I.id+"::"+me;_e.index("_doc_id_rev").get(De).onsuccess=function(Pe){if(M=Pe.target.result,M&&(M=zt(M)),!M)return G=Ee(rt,"missing"),Z();Z()}}},e._getAttachment=function(g,O,x,j,M){var I;if(j.ctx)I=j.ctx;else{var G=ut(i,[Ge,Ye,at],"readonly");if(G.error)return M(G.error);I=G.txn}var W=x.digest,re=x.content_type;I.objectStore(at).get(W).onsuccess=function(Z){var fe=Z.target.result.body;Sr(fe,re,j.binary,function(me){M(null,me)})}},e._info=function(O){var x,j,M=ut(i,[Ve,Ye],"readonly");if(M.error)return O(M.error);var I=M.txn;I.objectStore(Ve).get(Ve).onsuccess=function(G){j=G.target.result.docCount},I.objectStore(Ye).openCursor(null,"prev").onsuccess=function(G){var W=G.target.result;x=W?W.key:0},I.oncomplete=function(){O(null,{doc_count:j,update_seq:x,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(O,x){Ia(O,i,x)},e._changes=function(O){return Na(O,e,r,i)},e._close=function(g){i.close(),Dt.delete(r),g()},e._getRevisionTree=function(g,O){var x=ut(i,[Ge],"readonly");if(x.error)return O(x.error);var j=x.txn,M=j.objectStore(Ge).get(g);M.onsuccess=function(I){var G=bt(I.target.result);G?O(null,G.rev_tree):O(Ee(rt))}},e._doCompaction=function(g,O,x){var j=[Ge,Ye,at,wt],M=ut(i,j,"readwrite");if(M.error)return x(M.error);var I=M.txn,G=I.objectStore(Ge);G.get(g).onsuccess=function(W){var re=bt(W.target.result);mt(re.rev_tree,function(me,ue,_e,De,Pe){var we=ue+"-"+_e;O.indexOf(we)!==-1&&(Pe.status="missing")}),Tr(O,g,I);var Z=re.winningRev,fe=re.deleted;I.objectStore(Ge).put(bn(re,Z,fe))},I.onabort=ct(x),I.oncomplete=function(){x()}},e._getLocal=function(g,O){var x=ut(i,[ft],"readonly");if(x.error)return O(x.error);var j=x.txn,M=j.objectStore(ft).get(g);M.onerror=ct(O),M.onsuccess=function(I){var G=I.target.result;G?(delete G._doc_id_rev,O(null,G)):O(Ee(rt))}},e._putLocal=function(g,O,x){typeof O=="function"&&(x=O,O={}),delete g._revisions;var j=g._rev,M=g._id;j?g._rev="0-"+(parseInt(j.split("-")[1],10)+1):g._rev="0-1";var I=O.ctx,G;if(!I){var W=ut(i,[ft],"readwrite");if(W.error)return x(W.error);I=W.txn,I.onerror=ct(x),I.oncomplete=function(){G&&x(null,G)}}var re=I.objectStore(ft),Z;j?(Z=re.get(M),Z.onsuccess=function(fe){var me=fe.target.result;if(!me||me._rev!==j)x(Ee(Ot));else{var ue=re.put(g);ue.onsuccess=function(){G={ok:!0,id:g._id,rev:g._rev},O.ctx&&x(null,G)}}}):(Z=re.add(g),Z.onerror=function(fe){x(Ee(Ot)),fe.preventDefault(),fe.stopPropagation()},Z.onsuccess=function(){G={ok:!0,id:g._id,rev:g._rev},O.ctx&&x(null,G)})},e._removeLocal=function(g,O,x){typeof O=="function"&&(x=O,O={});var j=O.ctx;if(!j){var M=ut(i,[ft],"readwrite");if(M.error)return x(M.error);j=M.txn,j.oncomplete=function(){I&&x(null,I)}}var I,G=g._id,W=j.objectStore(ft),re=W.get(G);re.onerror=ct(x),re.onsuccess=function(Z){var fe=Z.target.result;!fe||fe._rev!==g._rev?x(Ee(rt)):(W.delete(G),I={ok:!0,id:G,rev:"0-0"},O.ctx&&x(null,I))}},e._destroy=function(g,O){xt.removeAllListeners(r);var x=Cn.get(r);x&&x.result&&(x.result.close(),Dt.delete(r));var j=indexedDB.deleteDatabase(r);j.onsuccess=function(){Cn.delete(r),Y()&&r in localStorage&&delete localStorage[r],O(null,{ok:!0})},j.onerror=ct(O)};var E=Dt.get(r);if(E)return i=E.idb,e._meta=E.global,A(function(){n(null,e)});var P=indexedDB.open(r,Da);Cn.set(r,P),P.onupgradeneeded=function(g){var O=g.target.result;if(g.oldVersion<1)return o(O);var x=g.currentTarget.transaction;g.oldVersion<3&&v(O),g.oldVersion<4&&k(O);var j=[f,m,U,d],M=g.oldVersion;function I(){var G=j[M-1];M++,G&&G(x,I)}I()},P.onsuccess=function(g){i=g.target.result,i.onversionchange=function(){i.close(),Dt.delete(r)},i.onabort=function(re){ge("error","Database has a global failure",re.target.error),i.close(),Dt.delete(r)};var O=i.transaction([Ve,wn,Ge],"readwrite"),x=!1,j,M,I;function G(){typeof M>"u"||!x||(e._meta={name:r,instanceId:I,blobSupport:M},Dt.set(r,{idb:i,global:e._meta}),n(null,e))}function W(){var re=r+"_id",Z=!1;re in j?I=j[re]:(j[re]=I=Ft(),Z=!0),"docCount"in j||(j.docCount=0,Z=!0),j.docCount,Z&&O.objectStore(Ve).put(j)}O.objectStore(Ve).get(Ve).onsuccess=function(re){j=re.target.result||{id:Ve},W()},Tn||(Tn=xa(O)),Tn.then(function(re){M=re,G()}),O.oncomplete=function(){x=!0,G()},O.onabort=ct(n)},P.onerror=function(g){var O=g.target.error&&g.target.error.message;O?O.indexOf("stored database is a higher version")!==-1&&(O=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):O="Failed to open indexedDB, are you in private browsing mode?",ge("error",O),n(Ee(en,O))}}Dr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function Ma(e){e.adapter("idb",Dr,!0)}function Fa(e,t){return new Promise(function(n,r){var i=0,o=0,f=0,v=e.length,m;function k(){i++,e[o++]().then(d,E)}function U(){++f===v?m?r(m):n():P()}function d(){i--,U()}function E(g){i--,m=m||g,U()}function P(){for(;i<t&&o<v;)k()}P()})}var Ha=25,za=50,Kt=5e3,Ka=1e4,En={};function Dn(e){var t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){var i=n[r];i.data=sn(i.data,i.content_type)})}function At(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Pr(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){fn(n.data,r)}).then(function(r){n.data=r})}))}function Ga(e){if(!e.prefix)return!1;var t=Zn(e.prefix).protocol;return t==="http"||t==="https"}function Ja(e,t){if(Ga(t)){var n=t.name.substr(t.prefix.length),r=t.prefix.replace(/\/?$/,"/");e=r+encodeURIComponent(n)}var i=Zn(e);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var o=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=o.pop(),i.db.indexOf("%")===-1&&(i.db=encodeURIComponent(i.db)),i.path=o.join("/"),i}function Je(e,t){return Gt(e,e.db+"/"+t)}function Gt(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Jt(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Wa(e){var t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,o=!("method"in e)||e.method==="GET";return(n||r||i)&&o}function Pn(e,t){var n=this,r=Ja(e.name,e),i=Je(r,"");e=s(e);var o=function(d,E){if(E=E||{},E.headers=E.headers||new Ct,e.auth||r.auth){var P=e.auth||r.auth,g=P.username+":"+P.password,O=Lt(unescape(encodeURIComponent(g)));E.headers.set("Authorization","Basic "+O)}var x=e.headers||{};Object.keys(x).forEach(function(M){E.headers.append(M,x[M])}),Wa(E)&&(d+=(d.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now());var j=e.fetch||fr;return j(d,E)};function f(d,E){return l(d,B(function(P){k().then(function(){return E.apply(this,P)}).catch(function(g){var O=P.pop();O(g)})})).bind(n)}function v(d,E,P){var g={};return E=E||{},E.headers=E.headers||new Ct,E.headers.get("Content-Type")||E.headers.set("Content-Type","application/json"),E.headers.get("Accept")||E.headers.set("Accept","application/json"),o(d,E).then(function(O){return g.ok=O.ok,g.status=O.status,O.json()}).then(function(O){if(g.data=O,!g.ok){g.data.status=g.status;var x=Tt(g.data);if(P)return P(x);throw x}if(Array.isArray(g.data)&&(g.data=g.data.map(function(j){return j.error||j.missing?Tt(j):j})),P)P(null,g.data);else return g})}var m;function k(){return e.skip_setup?Promise.resolve():m||(m=v(i).catch(function(d){return d&&d.status&&d.status===404?(tt(404,"PouchDB is just detecting if the remote exists."),v(i,{method:"PUT"})):Promise.reject(d)}).catch(function(d){return d&&d.status&&d.status===412?!0:Promise.reject(d)}),m.catch(function(){m=null}),m)}A(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=f("id",function(d){o(Gt(r,"")).then(function(E){return E.json()}).catch(function(){return{}}).then(function(E){var P=E&&E.uuid?E.uuid+r.db:Je(r,"");d(null,P)})}),n.compact=f("compact",function(d,E){typeof d=="function"&&(E=d,d={}),d=s(d),v(Je(r,"_compact"),{method:"POST"}).then(function(){function P(){n.info(function(g,O){O&&!O.compact_running?E(null,{ok:!0}):setTimeout(P,d.interval||200)})}P()})}),n.bulkGet=l("bulkGet",function(d,E){var P=this;function g(M){var I={};d.revs&&(I.revs=!0),d.attachments&&(I.attachments=!0),d.latest&&(I.latest=!0),v(Je(r,"_bulk_get"+Jt(I)),{method:"POST",body:JSON.stringify({docs:d.docs})}).then(function(G){d.attachments&&d.binary&&G.data.results.forEach(function(W){W.docs.forEach(Dn)}),M(null,G.data)}).catch(M)}function O(){var M=za,I=Math.ceil(d.docs.length/M),G=0,W=new Array(I);function re(me){return function(ue,_e){W[me]=_e.results,++G===I&&E(null,{results:$t(W)})}}for(var Z=0;Z<I;Z++){var fe=y(d,["revs","attachments","binary","latest"]);fe.docs=d.docs.slice(Z*M,Math.min(d.docs.length,(Z+1)*M)),J(P,fe,re(Z))}}var x=Gt(r,""),j=En[x];typeof j!="boolean"?g(function(M,I){M?(En[x]=!1,tt(M.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),O()):(En[x]=!0,E(null,I))}):j?g(E):O()}),n._info=function(d){k().then(function(){return o(Je(r,""))}).then(function(E){return E.json()}).then(function(E){E.host=Je(r,""),d(null,E)}).catch(d)},n.fetch=function(d,E){return k().then(function(){var P=d.substring(0,1)==="/"?Gt(r,d.substring(1)):Je(r,d);return o(P,E)})},n.get=f("get",function(d,E,P){typeof E=="function"&&(P=E,E={}),E=s(E);var g={};E.revs&&(g.revs=!0),E.revs_info&&(g.revs_info=!0),E.latest&&(g.latest=!0),E.open_revs&&(E.open_revs!=="all"&&(E.open_revs=JSON.stringify(E.open_revs)),g.open_revs=E.open_revs),E.rev&&(g.rev=E.rev),E.conflicts&&(g.conflicts=E.conflicts),E.update_seq&&(g.update_seq=E.update_seq),d=At(d);function O(M){var I=M._attachments,G=I&&Object.keys(I);if(!I||!G.length)return;function W(Z){var fe=I[Z],me=At(M._id)+"/"+U(Z)+"?rev="+M._rev;return o(Je(r,me)).then(function(ue){return"buffer"in ue?ue.buffer():ue.blob()}).then(function(ue){if(E.binary){var _e=Object.getOwnPropertyDescriptor(ue.__proto__,"type");return(!_e||_e.set)&&(ue.type=fe.content_type),ue}return new Promise(function(De){fn(ue,De)})}).then(function(ue){delete fe.stub,delete fe.length,fe.data=ue})}var re=G.map(function(Z){return function(){return W(Z)}});return Fa(re,5)}function x(M){return Array.isArray(M)?Promise.all(M.map(function(I){if(I.ok)return O(I.ok)})):O(M)}var j=Je(r,d+Jt(g));v(j).then(function(M){return Promise.resolve().then(function(){if(E.attachments)return x(M.data)}).then(function(){P(null,M.data)})}).catch(function(M){M.docId=d,P(M)})}),n.remove=f("remove",function(d,E,P,g){var O;typeof E=="string"?(O={_id:d,_rev:E},typeof P=="function"&&(g=P,P={})):(O=d,typeof E=="function"?(g=E,P={}):(g=P,P=E));var x=O._rev||P.rev,j=Je(r,At(O._id))+"?rev="+x;v(j,{method:"DELETE"},g).catch(g)});function U(d){return d.split("/").map(encodeURIComponent).join("/")}n.getAttachment=f("getAttachment",function(d,E,P,g){typeof P=="function"&&(g=P,P={});var O=P.rev?"?rev="+P.rev:"",x=Je(r,At(d))+"/"+U(E)+O,j;o(x,{method:"GET"}).then(function(M){if(j=M.headers.get("content-type"),M.ok)return typeof p<"u"&&!p.browser&&typeof M.buffer=="function"?M.buffer():M.blob();throw M}).then(function(M){typeof p<"u"&&!p.browser&&(M.type=j),g(null,M)}).catch(function(M){g(M)})}),n.removeAttachment=f("removeAttachment",function(d,E,P,g){var O=Je(r,At(d)+"/"+U(E))+"?rev="+P;v(O,{method:"DELETE"},g).catch(g)}),n.putAttachment=f("putAttachment",function(d,E,P,g,O,x){typeof O=="function"&&(x=O,O=g,g=P,P=null);var j=At(d)+"/"+U(E),M=Je(r,j);if(P&&(M+="?rev="+P),typeof g=="string"){var I;try{I=an(g)}catch{return x(Ee(Kn,"Attachment is not a valid base64 string"))}g=I?un(I,O):""}v(M,{headers:new Ct({"Content-Type":O}),method:"PUT",body:g},x).catch(x)}),n._bulkDocs=function(d,E,P){d.new_edits=E.new_edits,k().then(function(){return Promise.all(d.docs.map(Pr))}).then(function(){return v(Je(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(d)},P)}).catch(P)},n._put=function(d,E,P){k().then(function(){return Pr(d)}).then(function(){return v(Je(r,At(d._id)),{method:"PUT",body:JSON.stringify(d)})}).then(function(g){P(null,g.data)}).catch(function(g){g.docId=d&&d._id,P(g)})},n.allDocs=f("allDocs",function(d,E){typeof d=="function"&&(E=d,d={}),d=s(d);var P={},g,O="GET";d.conflicts&&(P.conflicts=!0),d.update_seq&&(P.update_seq=!0),d.descending&&(P.descending=!0),d.include_docs&&(P.include_docs=!0),d.attachments&&(P.attachments=!0),d.key&&(P.key=JSON.stringify(d.key)),d.start_key&&(d.startkey=d.start_key),d.startkey&&(P.startkey=JSON.stringify(d.startkey)),d.end_key&&(d.endkey=d.end_key),d.endkey&&(P.endkey=JSON.stringify(d.endkey)),typeof d.inclusive_end<"u"&&(P.inclusive_end=!!d.inclusive_end),typeof d.limit<"u"&&(P.limit=d.limit),typeof d.skip<"u"&&(P.skip=d.skip);var x=Jt(P);typeof d.keys<"u"&&(O="POST",g={keys:d.keys}),v(Je(r,"_all_docs"+x),{method:O,body:JSON.stringify(g)}).then(function(j){d.include_docs&&d.attachments&&d.binary&&j.data.rows.forEach(Dn),E(null,j.data)}).catch(E)}),n._changes=function(d){var E="batch_size"in d?d.batch_size:Ha;d=s(d),d.continuous&&!("heartbeat"in d)&&(d.heartbeat=Ka);var P="timeout"in d?d.timeout:30*1e3;"timeout"in d&&d.timeout&&P-d.timeout<Kt&&(P=d.timeout+Kt),"heartbeat"in d&&d.heartbeat&&P-d.heartbeat<Kt&&(P=d.heartbeat+Kt);var g={};"timeout"in d&&d.timeout&&(g.timeout=d.timeout);var O=typeof d.limit<"u"?d.limit:!1,x=O;if(d.style&&(g.style=d.style),(d.include_docs||d.filter&&typeof d.filter=="function")&&(g.include_docs=!0),d.attachments&&(g.attachments=!0),d.continuous&&(g.feed="longpoll"),d.seq_interval&&(g.seq_interval=d.seq_interval),d.conflicts&&(g.conflicts=!0),d.descending&&(g.descending=!0),d.update_seq&&(g.update_seq=!0),"heartbeat"in d&&d.heartbeat&&(g.heartbeat=d.heartbeat),d.filter&&typeof d.filter=="string"&&(g.filter=d.filter),d.view&&typeof d.view=="string"&&(g.filter="_view",g.view=d.view),d.query_params&&typeof d.query_params=="object")for(var j in d.query_params)d.query_params.hasOwnProperty(j)&&(g[j]=d.query_params[j]);var M="GET",I;d.doc_ids?(g.filter="_doc_ids",M="POST",I={doc_ids:d.doc_ids}):d.selector&&(g.filter="_selector",M="POST",I={selector:d.selector});var G=new Bi,W,re=function(me,ue){if(!d.aborted){g.since=me,typeof g.since=="object"&&(g.since=JSON.stringify(g.since)),d.descending?O&&(g.limit=x):g.limit=!O||x>E?E:x;var _e=Je(r,"_changes"+Jt(g)),De={signal:G.signal,method:M,body:JSON.stringify(I)};W=me,!d.aborted&&k().then(function(){return v(_e,De,ue)}).catch(ue)}},Z={results:[]},fe=function(me,ue){if(!d.aborted){var _e=0;if(ue&&ue.results){_e=ue.results.length,Z.last_seq=ue.last_seq;var De=null,Pe=null;typeof ue.pending=="number"&&(De=ue.pending),(typeof Z.last_seq=="string"||typeof Z.last_seq=="number")&&(Pe=Z.last_seq);var we={};we.query=d.query_params,ue.results=ue.results.filter(function(be){x--;var Re=tn(d)(be);return Re&&(d.include_docs&&d.attachments&&d.binary&&Dn(be),d.return_docs&&Z.results.push(be),d.onChange(be,De,Pe)),Re})}else if(me){d.aborted=!0,d.complete(me);return}ue&&ue.last_seq&&(W=ue.last_seq);var Se=O&&x<=0||ue&&_e<E||d.descending;d.continuous&&!(O&&x<=0)||!Se?A(function(){re(W,fe)}):d.complete(null,Z)}};return re(d.since||0,fe),{cancel:function(){d.aborted=!0,G.abort()}}},n.revsDiff=f("revsDiff",function(d,E,P){typeof E=="function"&&(P=E,E={}),v(Je(r,"_revs_diff"),{method:"POST",body:JSON.stringify(d)},P).catch(P)}),n._close=function(d){d()},n._destroy=function(d,E){v(Je(r,""),{method:"DELETE"}).then(function(P){E(null,P)}).catch(function(P){P.status===404?E(null,{ok:!0}):E(P)})}}Pn.valid=function(){return!0};function Qa(e){e.adapter("http",Pn,!1),e.adapter("https",Pn,!1)}function St(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,St)}catch{}}Q(St,Error);function Wt(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Wt)}catch{}}Q(Wt,Error);function Qt(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Qt)}catch{}}Q(Qt,Error);function qr(e,t){return t&&e.then(function(n){A(function(){t(null,n)})},function(n){A(function(){t(n)})}),e}function Xa(e){return B(function(t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&qr(r,n),r})}function Ya(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function qn(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function Lr(e){var t=new Set(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function Ln(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Rr(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new Qt(t)}function Rn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var o=0,f=i.length;o<f;o++){var v=i[o];if(typeof v!="number")throw Rr("_sum");typeof t[o]>"u"?t.push(v):t[o]+=v}}else throw Rr("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var Za=ge.bind(null,"log"),Va=Array.isArray,eo=JSON.parse;function kn(e,t){return rn("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Rn,log:Za,isArray:Va,toJSON:eo})}function jt(){this.promise=new Promise(function(e){e()})}jt.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},jt.prototype.finish=function(){return this.promise};function kr(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function to(e,t){return kr(e)+kr(t)+"undefined"}function Br(e,t,n,r,i,o,f){var v=to(n,r),m;if(!o&&(m=e._cachedViews=e._cachedViews||{},m[v]))return m[v];var k=e.info().then(function(U){var d=U.db_name+"-mrview-"+(o?"temp":ln(v));function E(P){P.views=P.views||{};var g=t;g.indexOf("/")===-1&&(g=t+"/"+t);var O=P.views[g]=P.views[g]||{};if(!O[d])return O[d]=!0,P}return Mt(e,"_local/"+f,E).then(function(){return e.registerDependentDatabase(d).then(function(P){return e.registerDependentDatabase(d+"_keys").then(function(g){var O=P.db;O.auto_compaction=!0,g.db.auto_compaction=!0;var x={name:d,db:O,keyDb:g.db,sourceDB:e,adapter:e.adapter,mapFun:n,indexCheckFun:i,reduceFun:r};return x.db.get("_local/lastSeq").catch(function(j){if(j.status!==404)throw j}).then(function(j){return x.seq=j?j.seq:0,m&&x.db.once("destroyed",function(){delete m[v]}),x})})})})});return m&&(m[v]=k),k}var Ir={},xr=new jt,no=25;function Bn(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function jr(e){return e.length===1&&/^1-/.test(e[0].rev)}function In(e,t){try{e.emit("error",t)}catch{ge("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),ge("error",t)}}function ro(e,t,n,r,i){i||(i=r,r=null);function o(C,R,T){try{return R(T)}catch(F){return In(C,F),""}}function f(C,R,T){try{R(T)}catch(F){In(C,F)}}function v(C,R,T,F,V){try{return{output:R(T,F,V)}}catch(ne){return In(C,ne),{error:ne}}}function m(C,R){var T=He(C.key,R.key);return T!==0?T:He(C.value,R.value)}function k(C,R,T){return T=T||0,typeof R=="number"?C.slice(T,R+T):T>0?C.slice(T):C}function U(C){var R=C.value,T=R&&typeof R=="object"&&R._id||C.id;return T}function d(C){C.rows.forEach(function(R){var T=R.doc&&R.doc._attachments;T&&Object.keys(T).forEach(function(F){var V=T[F];T[F].data=sn(V.data,V.content_type)})})}function E(C){return function(R){return C.include_docs&&C.attachments&&C.binary&&d(R),R}}function P(C,R,T,F){var V=R[C];typeof V<"u"&&(F&&(V=encodeURIComponent(JSON.stringify(V))),T.push(C+"="+V))}function g(C){if(typeof C<"u"){var R=Number(C);return!isNaN(R)&&R===parseInt(C,10)?R:C}}function O(C){return C.group_level=g(C.group_level),C.limit=g(C.limit),C.skip=g(C.skip),C}function x(C){if(C){if(typeof C!="number")return new St('Invalid value for integer: "'+C+'"');if(C<0)return new St('Invalid value for positive integer: "'+C+'"')}}function j(C,R){var T=C.descending?"endkey":"startkey",F=C.descending?"startkey":"endkey";if(typeof C[T]<"u"&&typeof C[F]<"u"&&He(C[T],C[F])>0)throw new St("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(R.reduce&&C.reduce!==!1){if(C.include_docs)throw new St("{include_docs:true} is invalid for reduce");if(C.keys&&C.keys.length>1&&!C.group&&!C.group_level)throw new St("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(V){var ne=x(C[V]);if(ne)throw ne})}function M(C,R,T){var F=[],V,ne="GET",ie,te;if(P("reduce",T,F),P("include_docs",T,F),P("attachments",T,F),P("limit",T,F),P("descending",T,F),P("group",T,F),P("group_level",T,F),P("skip",T,F),P("stale",T,F),P("conflicts",T,F),P("startkey",T,F,!0),P("start_key",T,F,!0),P("endkey",T,F,!0),P("end_key",T,F,!0),P("inclusive_end",T,F),P("key",T,F,!0),P("update_seq",T,F),F=F.join("&"),F=F===""?"":"?"+F,typeof T.keys<"u"){var se=2e3,ve="keys="+encodeURIComponent(JSON.stringify(T.keys));ve.length+F.length+1<=se?F+=(F[0]==="?"?"&":"?")+ve:(ne="POST",typeof R=="string"?V={keys:T.keys}:R.keys=T.keys)}if(typeof R=="string"){var Le=Bn(R);return C.fetch("_design/"+Le[0]+"/_view/"+Le[1]+F,{headers:new Ct({"Content-Type":"application/json"}),method:ne,body:JSON.stringify(V)}).then(function(le){return ie=le.ok,te=le.status,le.json()}).then(function(le){if(!ie)throw le.status=te,Tt(le);return le.rows.forEach(function(Oe){if(Oe.value&&Oe.value.error&&Oe.value.error==="builtin_reduce_error")throw new Error(Oe.reason)}),le}).then(E(T))}return V=V||{},Object.keys(R).forEach(function(le){Array.isArray(R[le])?V[le]=R[le]:V[le]=R[le].toString()}),C.fetch("_temp_view"+F,{headers:new Ct({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(V)}).then(function(le){return ie=le.ok,te=le.status,le.json()}).then(function(le){if(!ie)throw le.status=te,Tt(le);return le}).then(E(T))}function I(C,R,T){return new Promise(function(F,V){C._query(R,T,function(ne,ie){if(ne)return V(ne);F(ie)})})}function G(C){return new Promise(function(R,T){C._viewCleanup(function(F,V){if(F)return T(F);R(V)})})}function W(C){return function(R){if(R.status===404)return C;throw R}}function re(C,R,T){var F="_local/doc_"+C,V={_id:F,keys:[]};return jr(T)?Promise.resolve(V):R.db.get(F).catch(W(V))}function Z(C,R,T,F){var V="_local/doc_"+C,ne={_id:V,keys:[]},ie=T.get(C),te=ie[0],se=ie[1];function ve(){return F[C]?Promise.resolve(F[C].metaDoc):jr(se)?Promise.resolve(ne):R.db.get(V).catch(W(ne))}function Le(Oe){return Oe.keys.length?R.db.allDocs({keys:Oe.keys,include_docs:!0}):Promise.resolve({rows:[]})}function le(Oe,xe){for(var We=[],Ne=new Set,Qe=0,Xe=xe.rows.length;Qe<Xe;Qe++){var et=xe.rows[Qe],Ae=et.doc;if(Ae&&(We.push(Ae),Ne.add(Ae._id),Ae._deleted=!te.has(Ae._id),!Ae._deleted)){var qe=te.get(Ae._id);"value"in qe&&(Ae.value=qe.value),Ae.key="a_"+qe.key,Ae.doc_id=qe.id}}var $e=Ln(te);return $e.forEach(function(Me){if(!Ne.has(Me)){var nt={_id:Me},Fe=te.get(Me);"value"in Fe&&(nt.value=Fe.value),nt.key="a_"+Fe.key,nt.doc_id=Fe.id,We.push(nt)}}),Oe.keys=Lr($e.concat(Oe.keys)),We.push(Oe),We}return ve().then(function(Oe){return Le(Oe).then(function(xe){return le(Oe,xe)})})}function fe(C,R){var T=new Set;R.forEach(function(ne){ne.key&&T.add(ne.key)});var F={},V=Array.from(T).map(function(ne){return it({key:ne})});return C.keyDb.allDocs({keys:V,include_docs:!0}).then(function(ne){ne.rows.forEach(function(ie){ie.doc&&ie.doc.key&&(F[ie.doc.key]=ie.doc)})}).then(function(){R.forEach(function(ie){if(!ie._id.startsWith("_local")&&ie.key){var te=F[ie.key];te||(F[ie.key]={_id:it({key:ie.key}),key:ie.key,doc_ids:[]},te=F[ie.key]);var se=new Set(te.doc_ids||[]);ie._deleted?se.delete(ie._id):se.add(ie._id),te.doc_ids=Array.from(se)}});var ne=[];return Object.keys(F).forEach(function(ie){ne.push(F[ie])}),C.keyDb.bulkDocs({docs:ne})})}function me(C,R,T,F){var V="_local/lastSeq";return C.db.get(V).catch(W({_id:V,seq:0})).then(function(ne){var ie=Ln(R);return Promise.all(ie.map(function(te){return Z(te,C,R,F)})).then(function(te){var se=$t(te);return fe(C,se).then(function(){return T>=0&&(ne.seq=T,se.push(ne)),C.db.bulkDocs({docs:se})})})})}function ue(C){var R=typeof C=="string"?C:C.name,T=Ir[R];return T||(T=Ir[R]=new jt),T}function _e(C,R){return qn(ue(C),function(){return De(C,R)})()}function De(C,R){var T,F;function V(Ae,qe){var $e={id:F._id,key:yt(Ae)};typeof qe<"u"&&qe!==null&&($e.value=yt(qe)),T.push($e)}var ne=t(C.mapFun,V),ie=R.indexCheck;r&&(ie=r(C.indexCheckFun)||ie);var te=R.since||C.seq||0,se=te,ve=0,Le=0;function le(Ae,qe,$e){return function(){return me(C,Ae,qe,$e)}}let Oe=0,xe={view:C.name,indexed_docs:Oe};C.sourceDB.emit("indexing",xe);var We=new jt;function Ne(){var Ae={return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:te,limit:R.changes_batch_size};return R.doc_ids&&(Ae.doc_ids=R.doc_ids),C.sourceDB.changes(Ae).then(Qe)}function Qe(Ae){var qe=Ae.results;if(R.showUpdateProgressInfo&&Le&&R.showUpdateProgressInfo(te,ve,te-se,Le),!!qe.length){var $e={};return Promise.all(qe.map(function(Me){var nt=Me;if(nt.doc._id[0]!=="_"){var Fe=nt.doc._id;return re(Fe,C,nt.changes).then(function(ot){return $e[Fe]={metaDoc:ot},ot})}})).then(function(Me){var nt=Xe(qe,$e);We.add(le(nt,R.doc_ids?-1:te,$e)),Oe=Oe+qe.length;let Fe={view:C.name,last_seq:Ae.last_seq,results_count:qe.length,indexed_docs:Oe};if(C.sourceDB.emit("indexing",Fe),!(qe.length<R.changes_batch_size))return Ne()})}}function Xe(Ae,qe){for(var $e=new Map,Me=0,nt=Ae.length;Me<nt;Me++){var Fe=Ae[Me];if(Fe.doc._id[0]!=="_"){if(T=[],F=Fe.doc,!F._deleted){if(ie){var ot=o(C.sourceDB,ie,F);ot=ot+"_xsj",ot=ln(ot);var To=qe[F._id].metaDoc.md5;if(ot===To){te=Fe.seq;continue}qe[F._id].metaDoc.md5=ot}f(C.sourceDB,ne,F)}T.sort(m);var Co=et(T);$e.set(Fe.doc._id,[Co,Fe.changes])}te=Fe.seq}return $e}function et(Ae){for(var qe=new Map,$e,Me=0,nt=Ae.length;Me<nt;Me++){var Fe=Ae[Me],ot=[Fe.key,Fe.id];Me>0&&He(Fe.key,$e)===0&&ot.push(Me),qe.set(it(ot),Fe),$e=Fe.key}return qe}return C.sourceDB.info().then(function(Ae){return ve=Ae.update_seq,Le=ve-te,Ne().then(function(){return We.finish()}).then(function(){R.showUpdateProgressInfo&&Le&&R.showUpdateProgressInfo(te,ve,te-se,Le),R.doc_ids||(C.seq=te)})})}function Pe(C,R,T){T.group_level===0&&delete T.group_level;var F=T.group||T.group_level,V=T.reduceFun||n(C.reduceFun),ne=[],ie=isNaN(T.group_level)?Number.POSITIVE_INFINITY:T.group_level;R.forEach(function(le){var Oe=ne[ne.length-1],xe=F?le.key:null;if(F&&Array.isArray(xe)&&(xe=xe.slice(0,ie)),Oe&&He(Oe.groupKey,xe)===0){Oe.keys.push([le.key,le.id]),Oe.ids.push(le.id),Oe.values.push(le.value);return}ne.push({keys:[[le.key,le.id]],ids:[le.id],values:[le.value],groupKey:xe})}),R=[];for(var te=0,se=ne.length;te<se;te++){var ve=ne[te],Le=v(C.sourceDB,V,ve.keys,ve.values,!1);if(Le.error&&Le.error instanceof Qt)throw Le.error;R.push({value:Le.error?null:Le.output,ids:ve.ids,key:ve.groupKey})}return{rows:k(R,T.limit,T.skip)}}function we(C,R){return qn(ue(C),function(){return Se(C,R)})()}function Se(C,R){var T=0,F=C.reduceFun&&R.reduce!==!1,V=R.skip||0;typeof R.keys<"u"&&!R.keys.length&&(R.limit=0,delete R.keys);function ne(Ne){Ne.include_docs=!0;var Qe=Ne.keys.map(function(et){return it({key:"a_"+et})}),Xe=[];return C.keyDb.allDocs({keys:Qe,include_docs:!0}).then(function(et){et.rows.forEach(function(Ae){Ae.doc&&Ae.doc.doc_ids&&Ae.doc.doc_ids.forEach(function(qe){Xe.push(qe)})})}).then(function(){return Xe.length==0?[]:(Ne.keys=Xe,C.db.allDocs(Ne).then(function(et){return T=et.total_rows,et.rows.map(function(Ae){if("value"in Ae.doc&&typeof Ae.doc.value=="object"&&Ae.doc.value!==null){var qe=Object.keys(Ae.doc.value).sort(),$e=["id","key","value"];if(!(qe<$e||qe>$e))return Ae.doc.value}var Me=mr(Ae.doc._id);return{key:Me[0],id:Me[1],value:"value"in Ae.doc?Ae.doc.value:null}})}))})}function ie(Ne){return Ne.include_docs=!0,C.db.allDocs(Ne).then(function(Qe){return T=Qe.total_rows,Qe.rows.map(function(Xe){if("value"in Xe.doc&&typeof Xe.doc.value=="object"&&Xe.doc.value!==null){var et=Object.keys(Xe.doc.value).sort(),Ae=["id","key","value"];if(!(et<Ae||et>Ae))return Xe.doc.value}var qe=mr(Xe.doc._id);return{key:qe[0],id:qe[1],value:"value"in Xe.doc?Xe.doc.value:null}})})}function te(Ne){var Qe;if(F?Qe=Pe(C,Ne,R):Qe={total_rows:T,offset:V,rows:Ne},R.update_seq&&(Qe.update_seq=C.seq),R.include_docs){var Xe=Lr(Ne.map(U));return Xe.length?C.sourceDB.allDocs({keys:Xe,include_docs:!0,conflicts:R.conflicts,attachments:R.attachments,binary:R.binary}).then(function(et){var Ae=new Map;return et.rows.forEach(function(qe){Ae.set(qe.id,qe.doc)}),Ne.forEach(function(qe){var $e=U(qe),Me=Ae.get($e);Me&&(qe.doc=Me)}),Qe}):Qe}else return Qe}if(typeof R.keys<"u"){var se=R.keys,ve={keys:se};return R.update_seq&&(ve.update_seq=!0),ne(ve).then($t).then(te)}else{var ve={descending:R.descending};R.update_seq&&(ve.update_seq=!0);var Le,le;if("start_key"in R&&(Le=R.start_key),"startkey"in R&&(Le=R.startkey),"end_key"in R&&(le=R.end_key),"endkey"in R&&(le=R.endkey),typeof Le<"u"&&(ve.startkey=R.descending?it([Le,{}]):it([Le])),typeof le<"u"){var Oe=R.inclusive_end!==!1;R.descending&&(Oe=!Oe),ve.endkey=it(Oe?[le,{}]:[le])}if(typeof R.key<"u"){var xe=it([R.key]),We=it([R.key,{}]);ve.descending?(ve.endkey=xe,ve.startkey=We):(ve.startkey=xe,ve.endkey=We)}return F||(typeof R.limit=="number"&&(ve.limit=R.limit),ve.skip=V),ie(ve).then(te)}}function be(C){return C.fetch("_view_cleanup",{headers:new Ct({"Content-Type":"application/json"}),method:"POST"}).then(function(R){return R.json()})}function Re(C){return C.get("_local/"+e).then(function(R){var T=new Map;Object.keys(R.views).forEach(function(V){var ne=Bn(V),ie="_design/"+ne[0],te=ne[1],se=T.get(ie);se||(se=new Set,T.set(ie,se)),se.add(te)});var F={keys:Ln(T),include_docs:!0};return C.allDocs(F).then(function(V){var ne={};V.rows.forEach(function(se){var ve=se.key.substring(8);T.get(se.key).forEach(function(Le){var le=ve+"/"+Le;R.views[le]||(le=Le);var Oe=Object.keys(R.views[le]),xe=se.doc&&se.doc.views&&se.doc.views[Le];Oe.forEach(function(We){ne[We]=ne[We]||xe})})});var ie=Object.keys(ne).filter(function(se){return!ne[se]}),te=ie.map(function(se){return qn(ue(se),function(){return Promise.all([new C.constructor(se,C.__opts).destroy(),new C.constructor(se+"_keys",C.__opts).destroy()])})()});return Promise.all(te).then(function(){return{ok:!0}})})},W({ok:!0}))}function Ue(C,R,T){if(typeof C._query=="function")return I(C,R,T);if(st(C))return M(C,R,T);var F={};if(Object.assign(F,T,{changes_batch_size:C.__opts.view_update_changes_batch_size||no}),typeof R!="string")return j(T,R),xr.add(function(){var se=Br(C,"temp_view/temp_view",R.map,R.reduce,R.indexCheck,!0,e);return se.then(function(ve){return Ya(_e(ve,F).then(function(){return we(ve,T)}),function(){return Promise.all([ve.keyDb.destroy(),ve.db.destroy()])})})}),xr.finish();var V=R,ne=Bn(V),ie=ne[0],te=ne[1];return C.get("_design/"+ie).then(function(se){var ve=se.views&&se.views[te];if(!ve)throw new Wt("ddoc "+se._id+" has no view named "+te);i(se,te),j(T,ve);var Le=Br(C,V,ve.map,ve.reduce,ve.indexCheck,!1,e);return Le.then(function(le){return T.info?{name:le.name,seq:le.seq}:T.destroy?Promise.all([le.keyDb.destroy(),le.db.destroy()]):T.stale==="ok"||T.stale==="update_after"?(T.stale==="update_after"&&A(function(){_e(le,F)}),we(le,T)):(T.beforeUpdateView&&T.beforeUpdateView(),_e(le,F).then(function(){return T.afterUpdateView&&T.afterUpdateView(),we(le,T)}))})})}function ze(C,R,T){var F=this;typeof R=="function"&&(T=R,R={}),R=R?O(R):{},typeof C=="function"&&(C={map:C});var V=Promise.resolve().then(function(){return Ue(F,C,R)});return qr(V,T),V}var Ze=Xa(function(){var C=this;return typeof C._viewCleanup=="function"?G(C):st(C)?be(C):Re(C)});return{query:ze,viewCleanup:Ze}}var xn={_sum:function(e,t){return Rn(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,o=0,f=r.length;o<f;o++){var v=r[o];i+=v*v}return i}return{sum:Rn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function io(e){if(/^_sum/.test(e))return xn._sum;if(/^_count/.test(e))return xn._count;if(/^_stats/.test(e))return xn._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function ao(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return kn(e.toString(),t)}function oo(e){return e?typeof e=="function"?e:kn(e):null}function uo(e){var t=e.toString(),n=io(t);return n||kn(t)}function so(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new Wt("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var fo="mrviews",Ur=ro(fo,ao,uo,oo,so);function co(e,t,n){return Ur.query.call(this,e,t,n)}function lo(e){return Ur.viewCleanup.call(this,e)}var ho={query:co,viewCleanup:lo};function Nr(e){return/^1-/.test(e)}function vo(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Ho(e){try{e=JSON.stringify(e)}catch{e=e+""}return e}function $r(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev,attachments:!0,binary:!1}).catch(function(i){return Promise.resolve("")})}))}function go(e,t,n){var r=st(t)&&!st(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(o){return Promise.all(i.map(function(f){return vo(o,n,f)?t.getAttachment(n._id,f):e.getAttachment(o._id,f)}))}).catch(function(o){if(o.status!==404)throw o;return $r(t,n)}):$r(t,n)}function mo(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function po(e,t,n,r){n=s(n);var i=[],o=!0;function f(){var E=mo(n);if(E.docs.length)return e.bulkGet(E).then(function(P){if(r.cancelled)throw new Error("cancelled");return Promise.all(P.results.map(function(g){return Promise.all(g.docs.map(function(O){var x=O.ok;return O.error&&(o=!1),!x||!x._attachments?x:go(t,e,x).then(function(j){var M=Object.keys(x._attachments),I=!1;return j.forEach(function(G,W){var re=x._attachments[M[W]];delete re.stub,delete re.length,re.data=G,G||(I=!0)}),I&&r.emit("denied",x),x})}))})).then(function(g){i=i.concat($t(g).filter(Boolean))}).catch(function(g){throw r.emit("error",g),g})})}function v(E){return E._attachments&&Object.keys(E._attachments).length>0}function m(E){return E._conflicts&&E._conflicts.length>0}function k(E){return e.allDocs({keys:E,include_docs:!0,conflicts:!0}).then(function(P){if(r.cancelled)throw new Error("cancelled");P.rows.forEach(function(g){g.deleted||!g.doc||!Nr(g.value.rev)||v(g.doc)||m(g.doc)||(g.doc._conflicts&&delete g.doc._conflicts,i.push(g.doc),delete n[g.id])})})}function U(){var E=Object.keys(n).filter(function(P){var g=n[P].missing;return g.length===1&&Nr(g[0])});if(E.length>0)return k(E)}function d(){return{ok:o,docs:i}}return Promise.resolve().then(U).then(f).then(d)}var Mr=1,Fr="pouchdb",yo=5,lt=0;function jn(e,t,n,r,i){return e.get(t).catch(function(o){if(o.status===404)return(e.adapter==="http"||e.adapter==="https")&&tt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Fr,version:Mr};throw o}).then(function(o){if(!i.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter(function(f){return f.session_id!==r}),o.history.unshift({last_seq:n,session_id:r}),o.history=o.history.slice(0,yo),o.version=Mr,o.replicator=Fr,o.session_id=r,o.last_seq=n,e.put(o).catch(function(f){if(f.status===409)return jn(e,t,n,r,i);throw f})})}function Ut(e,t,n,r,i){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=i||{}}Ut.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},Ut.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?jn(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},Ut.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return jn(this.src,this.id,e,t,this.returnValue).catch(function(r){if(Kr(r))return n.opts.writeSourceCheckpoint=!1,!0;throw r})}else return Promise.resolve(!0)};var Hr={undefined:function(e,t){return He(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return _o(t,e).last_seq}};Ut.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(t){return t.last_seq||lt}).catch(function(t){if(t.status!==404)throw t;return lt}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||lt:e.src.get(e.id).then(function(n){if(t.version!==n.version)return lt;var r;return t.version?r=t.version.toString():r="undefined",r in Hr?Hr[r](t,n):lt},function(n){if(n.status===404&&t.last_seq)return e.src.put({_id:e.id,last_seq:lt}).then(function(){return lt},function(r){return Kr(r)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):lt});throw n})}).catch(function(t){if(t.status!==404)throw t;return lt})};function _o(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:zr(e.history,t.history)}function zr(e,t){var n=e[0],r=e.slice(1),i=t[0],o=t.slice(1);if(!n||t.length===0)return{last_seq:lt,history:[]};var f=n.session_id;if(Un(f,t))return{last_seq:n.last_seq,history:e};var v=i.session_id;return Un(v,r)?{last_seq:i.last_seq,history:o}:zr(r,o)}function Un(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:Un(e,r)}function Kr(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}var Gr=0;function wo(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=Ie),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=Gr},o=function(){t.removeListener("active",i)};t.once("paused",o),t.once("active",i)}e.current_back_off=e.current_back_off||Gr,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function bo(e){return Object.keys(e).sort(He).reduce(function(t,n){return t[n]=e[n],t},{})}function Ao(e,t,n){var r=n.doc_ids?n.doc_ids.sort(He):"",i=n.filter?n.filter.toString():"",o="",f="",v="";return n.selector&&(v=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(bo(n.query_params))),n.filter&&n.filter==="_view"&&(f=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(m){var k=m[0]+m[1]+i+f+o+r+v;return new Promise(function(U){cn(k,U)})}).then(function(m){return m=m.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+m})}function Jr(e,t,n,r,i){var o=[],f,v={seq:0,changes:[],docs:[]},m=!1,k=!1,U=!1,d=0,E=n.continuous||n.live||!1,P=n.batch_size||100,g=n.batches_limit||10,O=n.style||"all_docs",x=!1,j=n.doc_ids,M=n.selector,I,G,W=[],re=Ft();i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var Z={};r.ready(e,t);function fe(){return G?Promise.resolve():Ao(e,t,n).then(function(T){I=T;var F={};n.checkpoint===!1?F={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?F={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?F={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:F={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},G=new Ut(e,t,I,r,F)})}function me(){if(W=[],f.docs.length!==0){var T=f.docs,F={timeout:n.timeout};return t.bulkDocs({docs:T,new_edits:!1},F).then(function(V){if(r.cancelled)throw be(),new Error("cancelled");var ne=Object.create(null);V.forEach(function(te){te.error&&(ne[te.id]=te)});var ie=Object.keys(ne).length;i.doc_write_failures+=ie,i.docs_written+=T.length-ie,T.forEach(function(te){var se=ne[te._id];if(se){i.errors.push(se);var ve=(se.name||"").toLowerCase();if(ve==="unauthorized"||ve==="forbidden")r.emit("denied",s(se));else throw se}else W.push(te)})},function(V){throw i.doc_write_failures+=T.length,V})}}function ue(){if(f.error)throw new Error("There was a problem getting docs.");i.last_seq=d=f.seq;var T=s(i);return W.length&&(T.docs=W,typeof f.pending=="number"&&(T.pending=f.pending,delete f.pending),(n.since==="now"||n._xsj_since==="now")&&(n._xsj_since="now",n.since=i.last_seq),r.emit("change",T)),m=!0,G.writeCheckpoint(f.seq,re).then(function(){if(r.emit("checkpoint",{checkpoint:f.seq}),m=!1,r.cancelled)throw be(),new Error("cancelled");f=void 0,Ze()}).catch(function(F){throw R(F),F})}function _e(){var T={};return f.changes.forEach(function(F){r.emit("checkpoint",{revs_diff:F}),F.id!=="_user/"&&(T[F.id]=F.changes.map(function(V){return V.rev}))}),t.revsDiff(T).then(function(F){if(r.cancelled)throw be(),new Error("cancelled");f.diffs=F})}function De(){return po(e,t,f.diffs,r).then(function(T){f.error=!T.ok,T.docs.forEach(function(F){delete f.diffs[F._id],i.docs_read++,f.docs.push(F)})})}function Pe(){if(!(r.cancelled||f)){if(o.length===0){we(!0);return}f=o.shift(),r.emit("checkpoint",{start_next_batch:f.seq}),_e().then(De).then(me).then(ue).then(Pe).catch(function(T){Se("batch processing terminated with error",T)})}}function we(T){if(v.changes.length===0){o.length===0&&!f&&((E&&Z.live||k)&&(r.state="pending",r.emit("paused")),k&&be());return}(T||k||v.changes.length>=P)&&(o.push(v),v={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),Pe())}function Se(T,F){U||(F.message||(F.message=T),i.ok=!1,i.status="aborting",o=[],v={seq:0,changes:[],docs:[]},be(F))}function be(T){if(!U&&!(r.cancelled&&(i.status="cancelled",m)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=d,U=!0,T){T=Ee(T),T.result=i;var F=(T.name||"").toLowerCase();F==="unauthorized"||F==="forbidden"?(r.emit("error",T),r.removeAllListeners()):wo(n,r,T,function(){Jr(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function Re(T,F,V){if(r.cancelled)return be();typeof F=="number"&&(v.pending=F);var ne=tn(n)(T);ne&&(v.seq=T.seq||V,v.changes.push(T),r.emit("checkpoint",{pending_batch:v.seq}),A(function(){we(o.length===0&&Z.live)}))}function Ue(T){if(x=!1,r.cancelled)return be();if(T.results.length>0)Z.since=T.results[T.results.length-1].seq,Ze(),we(!0);else{var F=function(){E?(Z.live=!0,Ze()):k=!0,we(!0)};!f&&T.results.length===0?(m=!0,G.writeCheckpoint(T.last_seq,re).then(function(){m=!1,i.last_seq=d=T.last_seq,F()}).catch(R)):F()}}function ze(T){if(x=!1,r.cancelled)return be();Se("changes rejected",T)}function Ze(){if(!(!x&&!k&&o.length<g))return;x=!0;function T(){V.cancel()}function F(){r.removeListener("cancel",T)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",T);var V=e.changes(Z).on("change",Re);V.then(F,F),V.then(Ue).catch(ze),n.retry&&(r._changes=V,r._abortChanges=T)}function C(){fe().then(function(){if(r.cancelled){be();return}return G.getCheckpoint().then(function(T){d=T,Z={since:d,limit:P,batch_size:P,style:O,doc_ids:j,selector:M,return_docs:!0},n.filter&&(typeof n.filter!="string"?Z.include_docs=!0:Z.filter=n.filter),"heartbeat"in n&&(Z.heartbeat=n.heartbeat),"timeout"in n&&(Z.timeout=n.timeout),n.query_params&&(Z.query_params=n.query_params),n.view&&(Z.view=n.view),Ze()})}).catch(function(T){Se("getCheckpoint rejected with ",T)})}function R(T){m=!1,Se("writeCheckpoint completed with error",T)}if(r.cancelled){be();return}r._addedListeners||(r.once("cancel",be),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(T){n.complete(null,T)})),r._addedListeners=!0),typeof n.since>"u"?C():fe().then(function(){return m=!0,G.writeCheckpoint(n.since,re)}).then(function(){if(m=!1,r.cancelled){be();return}d=n.since,C()}).catch(R)}Q(Xt,K);function Xt(){K.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise(function(n,r){e.once("complete",n),e.once("error",r)});e.then=function(n,r){return t.then(n,r)},e.catch=function(n){return t.catch(n)},e.catch(function(){})}Xt.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Xt.prototype.ready=function(e,t){var n=this;if(n._readyCalled)return;n._readyCalled=!0;function r(){n.cancel()}e.once("destroyed",r),t.once("destroyed",r);function i(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}n.once("complete",i),n.once("error",i)};function Yt(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function Nn(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw Ee(Nt,"`doc_ids` filter parameter is not a list.");n.complete=r,n=s(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new Xt,o=Yt(e,n),f=Yt(t,n);return Jr(o,f,n,i),i}Q($n,K);function So(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=s(n),n.PouchConstructor=n.PouchConstructor||this,e=Yt(e,n),t=Yt(t,n),new $n(e,t,n,r)}function $n(e,t,n,r){var i=this;this.canceled=!1;var o=n.push?Object.assign({},n,n.push):n,f=n.pull?Object.assign({},n,n.pull):n;this.push=Nn(e,t,o),this.pull=Nn(t,e,f),this.pushPaused=!0,this.pullPaused=!0;function v(I){i.emit("change",{direction:"pull",change:I})}function m(I){i.emit("change",{direction:"push",change:I})}function k(I){i.emit("denied",{direction:"push",doc:I})}function U(I){i.emit("denied",{direction:"pull",doc:I})}function d(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function E(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function P(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function g(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}var O={};function x(I){return function(G,W){var re=G==="change"&&(W===v||W===m),Z=G==="denied"&&(W===U||W===k),fe=G==="paused"&&(W===E||W===d),me=G==="active"&&(W===g||W===P);(re||Z||fe||me)&&(G in O||(O[G]={}),O[G][I]=!0,Object.keys(O[G]).length===2&&i.removeAllListeners(G))}}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push)));function j(I,G,W){I.listeners(G).indexOf(W)==-1&&I.on(G,W)}this.on("newListener",function(I){I==="change"?(j(i.pull,"change",v),j(i.push,"change",m)):I==="denied"?(j(i.pull,"denied",U),j(i.push,"denied",k)):I==="active"?(j(i.pull,"active",g),j(i.push,"active",P)):I==="paused"&&(j(i.pull,"paused",E),j(i.push,"paused",d))}),this.on("removeListener",function(I){I==="change"?(i.pull.removeListener("change",v),i.push.removeListener("change",m)):I==="denied"?(i.pull.removeListener("denied",U),i.push.removeListener("denied",k)):I==="active"?(i.pull.removeListener("active",g),i.push.removeListener("active",P)):I==="paused"&&(i.pull.removeListener("paused",E),i.push.removeListener("paused",d))}),this.pull.on("removeListener",x("pull")),this.push.on("removeListener",x("push"));var M=Promise.all([this.push,this.pull]).then(function(I){var G={push:I[0],pull:I[1]};return i.emit("complete",G),r&&r(null,G),i.removeAllListeners(),G},function(I){if(i.cancel(),r?r(I):i.emit("error",I),i.removeAllListeners(),r)throw I});this.then=function(I,G){return M.then(I,G)},this.catch=function(I){return M.catch(I)}}$n.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};function Oo(e){e.replicate=Nn,e.sync=So,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}Te.plugin(Ma).plugin(Qa).plugin(ho).plugin(Oo),w.exports=Te}).call(this)}).call(this,b(11))},{1:1,10:10,11:11,12:12,13:13,28:28,3:3,4:4}]},{},[29])(29)});const Io="friendly-data",xo={revs_limit:50,adapter:"idb"},vt=new PouchDB(Io,xo),Mn=async(b,w,h={})=>{const p=qt();let S={};try{S=await vt.get(b)}catch{}const A={createDate:p,...S,updateDate:p,...w,_id:b},N=A.fileInfos||{},D=[];Object.values(h).forEach(B=>{N[B.filename]={src:B.src,size:B.blob.size,type:B.blob.type},D.push({_id:b+"__"+B.filename,docId:b,filename:B.filename,type:"attachment",createDate:p,updateDate:p,_attachments:{attachment:{content_type:B.blob.type,data:B.blob}}})}),A.fileInfos=N;const L=await vt.put(A);if(D.length>0){const B=await vt.allDocs({keys:D.map(K=>K._id)}),Q={};B.rows.forEach(K=>{K.value&&(Q[K.id]=K.value.rev)}),D.forEach(K=>{const H=Q[K._id];H&&(K._rev=H)}),await vt.bulkDocs(D)}return A._rev=L.rev,A},jo=async(b,w)=>{try{return await vt.get(b,{attachments:!1,binary:!0})}catch{}return null},Uo=async(b,w)=>{try{return await vt.get(b+"__"+w,{attachments:!0,binary:!0})}catch{}return null},No=async(b=[])=>{const h=(await vt.allDocs()).rows.map(p=>({_id:p.id,_rev:p.value.rev,_deleted:!0})).filter(p=>!b.find(S=>p._id.startsWith(S)));await vt.bulkDocs(h),await vt.compact()},$o=50,Mo=async b=>{let w=[];const h="fileIds";try{w=JSON.parse(localStorage.getItem(h))}catch{}w.push(b),w.length>$o&&(w=w.slice(w.length-10),await No(w)),localStorage.setItem(h,JSON.stringify(w))};(async function(){var he;const b="xsjHeaderOutline",w=window.matchMedia("(prefers-color-scheme: dark)").matches;window.matchMedia("(max-width: 1023.5px)").matches;const h="textarea#open-source-plugins",p={};let S="";const A=`
  ::root{
      --scrollbarColor: transparent;
  }

  html:hover{
      --scrollbarColor: rgba(0,0,0,0.3);
  }

  ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
  }
  ::-webkit-scrollbar-track-piece {

  }
  ::-webkit-scrollbar-thumb:vertical {
      height: 5px;
      background-color: var(--scrollbarColor);
      -webkit-border-radius: 6px;
  }
  ::-webkit-scrollbar-thumb:horizontal {
      width: 5px;
      background-color: var(--scrollbarColor);
      -webkit-border-radius: 6px;
  }

  ::-webkit-scrollbar-thumb:hover{
      background-color: rgba(0,0,0,.7);
  }
  body {
    padding-top: 10px;
    padding-bottom: 50VH;
  }
  @media print{
    body {
      padding-top: initial;
      padding-bottom: initial;
    }
  }
  `,N=async(q,z)=>{const s="images/"+qt()+q.filename(),c=q.blob(),a={};a[s]={src:"",filename:s,blob:c},await Mn(S,{},a);const u=window.URL.createObjectURL(c);return p[u]={fileId:S,filename:s},u};let D=null;const L=async(q={})=>{const s=(await tinymce.init({promotion:!1,branding:!1,resize:!1,help_accessibility:!1,selector:h,formats:{forecolor:{inline:"span",classes:"forecolor",styles:{color:"%value"}},hilitecolor:{inline:"span",classes:"hilitecolor",styles:{backgroundColor:"%value"}}},color_default_background:"#BA372A",color_default_foreground:"#169179",plugins:"importcss searchreplace autolink autosave save directionality code visualblocks visualchars image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount help charmap quickbars emoticons accordion",editimage_cors_hosts:["picsum.photos"],menubar:"file edit view insert format tools table help",menu:{file:{title:"File",items:""},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | styles blocks fontsize align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"}},toolbar:"undo redo | h1 h2 h3 | bold italic underline strikethrough | forecolor backcolor removeformat | link quickimage | fontsize align lineheight numlist bullist | table media | outdent indent| charmap emoticons | codeformat pagebreak anchor codesample | ltr rtl | accordion accordionremove",autosave_ask_before_unload:!1,autosave_interval:"1s",autosave_prefix:"{path}{query}-{id}-",autosave_restore_when_empty:!1,autosave_retention:"2m",save_onsavecallback:()=>{},image_advtab:!0,importcss_append:!0,height:"100%",image_caption:!0,automatic_uploads:!0,images_upload_handler:N,quickbars_selection_toolbar:"bold italic underline strikethrough | forecolor backcolor removeformat | quicklink",quickbars_insert_toolbar:"quickimage quicktable numlist bullist pagebreak",quickbars_image_toolbar:"alignleft aligncenter alignright | rotateleft rotateright | imageoptions",noneditable_class:"mceNonEditable",toolbar_mode:"floating",contextmenu:"copy cut paste pastetext selectall | align | link image insertdatetime",skin:w?"oxide-dark":"oxide",content_css:w?"dark":"default",content_style:A}))[0];return s.editorUpload.addFilter(c=>!(!c.src||p[c.src])),s},B=_.debounce(()=>{const q=D.getContent(),s=new DOMParser().parseFromString(q,"text/html");s.querySelectorAll("img").forEach(c=>{const a=c.src,u=p[a];u&&(c.src="",c.dataset.filename=u.filename)}),Mn(S,{content:s.body.innerHTML})},3e3),Q=()=>[...D.getDoc().querySelectorAll("h1,h2,h3,h4,h5,h6")].filter(s=>!0).map((s,c)=>(s.dataset[b]=c,[parseInt(s.tagName.substring(1)),s.innerText.replace(/\n*/g,""),c+""])),K={},H=async(q,z,s)=>{const c=async y=>{const de=y.src;if(s[de]){const{blob:pe,filename:Ce}=s[de],J=window.URL.createObjectURL(pe);p[J]={fileId:q,filename:Ce},y.src=J,y.dataset.filename=Ce}},u=new DOMParser().parseFromString(z,"text/html"),l=u.querySelectorAll("img");return await Promise.all([...l].map(c)),u.querySelectorAll("pre").forEach(y=>{const de=y.querySelector("code");if(de){let pe=de.dataset.lang||de.lang||"markup";const Ce=u.createElement("code");Ce.innerText=de.innerText;const J=u.createElement("pre");J.classList.add("language-"+pe),J.append(Ce),y.replaceWith(J)}}),u.body.innerHTML},ee=q=>z=>{q.source.postMessage({type:"showProgressInfo",data:z},q.origin)},oe=async q=>{var c;if(q.source===window)return;const z=q.data||{},s=z.data;switch(z.type){case"init":{if(D.on("ScrollContent",()=>{q.source.postMessage({type:"scroll"},q.origin)}),D.on("Change",()=>{const a=Q();B(),q.source.postMessage({type:"outline",data:{outline:a}},q.origin)}),(c=s.articleData)!=null&&c.html){const a=await H(s.articleData.fileId,s.articleData.html,s.articleData.fileInfos);await Mn(s.articleData.fileId,{title:s.articleData.title,meta:s.articleData.meta,type:"html",content:a},s.articleData.fileInfos),await Mo(s.articleData.fileId),D.setContent(a),S=s.articleData.fileId}q.source.postMessage({type:"inited",data:{uniqueId:s.uniqueId,outline:Q()}},q.origin);break}case"wheel":{D.getDoc().documentElement.scrollTop+=s.deltaY;break}case"scrollToTarget":{const a=s.key,u=D.getDoc(),l=u.documentElement,y=D.getContentAreaContainer().getBoundingClientRect(),de=(Ce,J)=>{Ce.source.postMessage({type:"highlightPos",data:{info:J}},Ce.origin)};if(a==="home"){const Ce={top:0,left:0};l.scrollTo(Ce),Ce.top+=20,de(q,{offset:y,pos:"home"});return}if(a==="end"){const Ce={top:u.body.scrollHeight,left:0};l.scrollTo(Ce),de(q,{offset:y,pos:"end"});return}const pe=u.querySelector(`[data-xsj-header-outline="${a}"]`);if(pe){pe.scrollIntoViewIfNeeded();const Ce=pe.getBoundingClientRect();de(q,{offset:y,pos:{left:Ce.left,top:Ce.top}})}break}case"themeStyle":{const a=D.getDoc(),u=a.createElement("style");u.classList.add("theme-style"),u.innerHTML=s.style;const l=a.querySelector(".theme-style");l?l.replaceWith(u):a.head.append(u);break}case"print":{D.getDoc().defaultView.print();break}case"savePdf":{const a=(u,l)=>{setTimeout(()=>{l(u)},1)};Bo(s.authInfo,D.getContent(),s.title,s.themeStyle||"",s.exportConfig,a,{showProgressInfo:ee(q)},(u,l,y,de)=>{q.source.postMessage({type:"savePdfResult",data:{uniqueId:s.uniqueId,error:u,downloadURL:y,downloadInfo:de}})})}case"getBlobByURLResult":{const a=s.uniqueId,u=K[a];u&&(delete K[a],u(s.err,s.blob));break}case"getHtml":{const a=D.getDoc(),u="vvvvvvvvvvvvvvvvvvvvvv";a.querySelectorAll("video").forEach(y=>{const de=Ke.captureVideo(y);if(de){const pe=document.createElement("img");pe.src=de,pe.classList.add(u),y.parentElement.insertBefore(pe,y)}});const l=a.body.parentElement.outerHTML;a.querySelectorAll(`.${u}`).forEach(y=>y.remove()),q.source.postMessage({type:"getHtmlResult",data:{uniqueId:s.uniqueId,html:l}},q.origin)}}};if(window.parent!==window){const z=new URLSearchParams(globalThis.location.search).get("fileId");D=await L();const s={},c=await jo(z);if(c){s.fileId=z,s.title=c.title,s.meta=c.meta;const a=c.content;D.setContent(a),S=z;const u=c.fileInfos;D.getDoc().querySelectorAll("img").forEach(async l=>{const y=l.dataset.filename;if(y&&u[y]){const de=await Uo(z,y),pe=de._attachments.attachment.data,Ce=window.URL.createObjectURL(pe);l.src=Ce,p[Ce]={fileId:de.docId,filename:de.filename}}})}(he=window.parent)==null||he.postMessage({type:"loaded",data:s},"*"),window.addEventListener("message",oe)}else await L()})()});export default Fo();
